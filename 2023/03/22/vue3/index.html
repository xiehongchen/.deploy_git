

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#bbe8e8">
  <meta name="author" content="XieHongchen">
  <meta name="keywords" content="">
  
    <meta name="description" content="vue3学习笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="vue3">
<meta property="og:url" content="https://xiehongchen.github.io/2023/03/22/vue3/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="vue3学习笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://user-images.githubusercontent.com/499550/93624428-53932780-f9ae-11ea-8d16-af949e16a09f.png">
<meta property="og:image" content="https://kalacloud.com/static/9affcc8711ebfcd3d3cc7269c57ced52/526aa/bundler.png">
<meta property="og:image" content="https://xiehongchen.github.io/img/vue/Snipaste_2023-04-16_20-15-44.png">
<meta property="og:image" content="https://xiehongchen.github.io/img/vue/lifecycle.16e4c08e.png">
<meta property="og:image" content="https://xiehongchen.github.io/img/vue/shengming.png">
<meta property="og:image" content="https://xiehongchen.github.io/img/vue/provide-inject.840efd40.png">
<meta property="og:image" content="https://xiehongchen.github.io/img/vue/f9e5558801104f81ac32c54d6cf5f587.png">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f84e4e2c02424d9a99862ade0a2e4114~tplv-k3u1fbpfcp-watermark.image">
<meta property="og:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e5ac7e20d1784887a826f6360768a368~tplv-k3u1fbpfcp-watermark.image">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc0be8211fc54b6c941c036791ba4efe~tplv-k3u1fbpfcp-watermark.image">
<meta property="og:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6cc55165c0e34069a75fe36f8712eb80~tplv-k3u1fbpfcp-watermark.image">
<meta property="og:image" content="https://xiehongchen.github.io/img/vue/566e8a5d6e5349638615ff65771896a0.png">
<meta property="og:image" content="https://xiehongchen.github.io/img/vue/c896c971d3ce407989d3439101a180ad.png">
<meta property="og:image" content="https://xiehongchen.github.io/img/vue/100a1402669844c2a0da76d7959c978e.png">
<meta property="og:image" content="https://xiehongchen.github.io/img/vue/185233f9afe8422fa815be3a22249e4a.png">
<meta property="og:image" content="https://xiehongchen.github.io/img/vue/35486eb0bd1a4dabac0035384f877cbe.png">
<meta property="og:image" content="https://xiehongchen.github.io/img/vue/e6d0ae1a4c254f13bde802f408fed4b3.png">
<meta property="article:published_time" content="2023-03-22T06:49:45.000Z">
<meta property="article:modified_time" content="2023-04-22T15:17:47.327Z">
<meta property="article:author" content="XieHongchen">
<meta property="article:tag" content="vue">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/499550/93624428-53932780-f9ae-11ea-8d16-af949e16a09f.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>vue3 - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"xiehongchen.github.io","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"left","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/preview.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="vue3"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        XieHongchen
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-03-22 14:49" pubdate>
          2023年3月22日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          64k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          531 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="padding-left: 2rem; margin-right: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">vue3</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="Vue3"><a href="#Vue3" class="headerlink" title="Vue3"></a>Vue3</h1><blockquote>
<p>学习：<br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1dS4y1y7vd">B站小满ZS</a><br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Zy4y1K7SH">B站尚硅谷</a></p>
</blockquote>
<h2 id="Vue3快速上手"><a href="#Vue3快速上手" class="headerlink" title="Vue3快速上手"></a>Vue3快速上手</h2><img src="https://user-images.githubusercontent.com/499550/93624428-53932780-f9ae-11ea-8d16-af949e16a09f.png" srcset="/img/loading.gif" lazyload style="width:200px" />



<h3 id="1-Vue3简介"><a href="#1-Vue3简介" class="headerlink" title="1.Vue3简介"></a>1.Vue3简介</h3><ul>
<li>2020年9月18日，Vue.js发布3.0版本，代号：One Piece（海贼王）</li>
<li>耗时2年多、<a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-next/graphs/commit-activity">2600+次提交</a>、<a target="_blank" rel="noopener" href="https://github.com/vuejs/rfcs/tree/master/active-rfcs">30+个RFC</a>、<a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-next/pulls?q=is:pr+is:merged+-author:app/dependabot-preview+">600+次PR</a>、<a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-next/graphs/contributors">99位贡献者</a> </li>
<li>github上的tags地址：<a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-next/releases/tag/v3.0.0">https://github.com/vuejs/vue-next/releases/tag/v3.0.0</a></li>
</ul>
<h3 id="2-Vue3带来了什么"><a href="#2-Vue3带来了什么" class="headerlink" title="2.Vue3带来了什么"></a>2.Vue3带来了什么</h3><h4 id="1-性能的提升"><a href="#1-性能的提升" class="headerlink" title="1.性能的提升"></a>1.性能的提升</h4><ul>
<li><p>打包大小减少41%</p>
</li>
<li><p>初次渲染快55%, 更新渲染快133%</p>
</li>
<li><p>内存减少54%</p>
<p>……</p>
</li>
</ul>
<h4 id="2-源码的升级"><a href="#2-源码的升级" class="headerlink" title="2.源码的升级"></a>2.源码的升级</h4><ul>
<li><p>使用Proxy代替defineProperty实现响应式</p>
</li>
<li><p>重写虚拟DOM的实现和Tree-Shaking</p>
<p>……</p>
</li>
</ul>
<h4 id="3-拥抱TypeScript"><a href="#3-拥抱TypeScript" class="headerlink" title="3.拥抱TypeScript"></a>3.拥抱TypeScript</h4><ul>
<li>Vue3可以更好的支持TypeScript</li>
</ul>
<h4 id="4-新的特性"><a href="#4-新的特性" class="headerlink" title="4.新的特性"></a>4.新的特性</h4><ol>
<li><p>Composition API（组合API）</p>
<ul>
<li>setup配置</li>
<li>ref与reactive</li>
<li>watch与watchEffect</li>
<li>provide与inject</li>
<li>……</li>
</ul>
</li>
<li><p>新的内置组件</p>
<ul>
<li>Fragment </li>
<li>Teleport</li>
<li>Suspense</li>
</ul>
</li>
<li><p>其他改变</p>
<ul>
<li>新的生命周期钩子</li>
<li>data 选项应始终被声明为一个函数</li>
<li>移除keyCode支持作为 v-on 的修饰符</li>
<li>……</li>
</ul>
</li>
</ol>
<h2 id="1、创建Vue3-0工程"><a href="#1、创建Vue3-0工程" class="headerlink" title="1、创建Vue3.0工程"></a>1、创建Vue3.0工程</h2><h3 id="1-使用-vue-cli-创建"><a href="#1-使用-vue-cli-创建" class="headerlink" title="1.使用 vue-cli 创建"></a>1.使用 vue-cli 创建</h3><p>官方文档：<a target="_blank" rel="noopener" href="https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create">https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## 查看@vue/cli版本，确保@vue/cli版本在4.5.0以上</span><br>vue --version<br><span class="hljs-comment">## 安装或者升级你的@vue/cli</span><br>npm install -g @vue/cli<br><span class="hljs-comment">## 创建</span><br>vue create vue_test<br><span class="hljs-comment">## 启动</span><br><span class="hljs-built_in">cd</span> vue_test<br>npm run serve<br></code></pre></td></tr></table></figure>

<h3 id="2-使用-vite-创建"><a href="#2-使用-vite-创建" class="headerlink" title="2.使用 vite 创建"></a>2.使用 vite 创建</h3><p>官方文档：<a target="_blank" rel="noopener" href="https://v3.cn.vuejs.org/guide/installation.html#vite">https://v3.cn.vuejs.org/guide/installation.html#vite</a></p>
<p>vite官网：<a target="_blank" rel="noopener" href="https://vitejs.cn/">https://vitejs.cn</a></p>
<ul>
<li>什么是vite？—— 新一代前端构建工具。</li>
<li>优势如下：<ul>
<li>开发环境中，无需打包操作，可快速的冷启动。</li>
<li>轻量快速的热重载（HMR）。</li>
<li>真正的按需编译，不再等待整个应用编译完成。</li>
</ul>
</li>
<li>传统构建 与 vite构建对比图</li>
</ul>
<img src="https://kalacloud.com/static/9affcc8711ebfcd3d3cc7269c57ced52/526aa/bundler.png" srcset="/img/loading.gif" lazyload />

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## 创建工程</span><br>npm init vite-app &lt;project-name&gt;<br><span class="hljs-comment">## 进入工程目录</span><br><span class="hljs-built_in">cd</span> &lt;project-name&gt;<br><span class="hljs-comment">## 安装依赖</span><br>npm install<br><span class="hljs-comment">## 运行</span><br>npm run dev<br></code></pre></td></tr></table></figure>

<h3 id="3、Vue3-项目结构"><a href="#3、Vue3-项目结构" class="headerlink" title="3、Vue3 项目结构"></a>3、Vue3 项目结构</h3><p>Vue3 中 <code>main.js</code> 代码有所改变：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 不再引入 Vue 构造函数，而是引入 createApp 工厂函数</span><br><span class="hljs-comment">// createApp函数：创建 vue 的 SPA 实例</span><br><span class="hljs-keyword">import</span> &#123; createApp &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.vue&#x27;</span><br><br><span class="hljs-comment">// 创建应用实例对象</span><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)<br>app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">&#x27;#app&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>Vue3 支持定义多个根节点，组件的 <code>&lt;template&gt;</code> 支持定义多个根节点：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>根节点<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>根节点<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="4、npm-run-dev详解"><a href="#4、npm-run-dev详解" class="headerlink" title="4、npm run dev详解"></a>4、<code>npm run dev</code>详解</h3><p>在我们执行这个命令的时候会去找 package json 的scripts 然后执行对应的dev命令</p>
<p><img src="/../img/vue/Snipaste_2023-04-16_20-15-44.png" srcset="/img/loading.gif" lazyload></p>
<p>其实在我们执行npm install 的时候（包含vite） 会在node_modules&#x2F;.bin&#x2F; 创建好可执行文件</p>
<p>.bin 目录，这个目录不是任何一个 npm 包。目录下的文件，表示这是一个个软链接，打开文件可以看到文件顶部写着 #!&#x2F;bin&#x2F;sh ，表示这是一个脚本 </p>
<blockquote>
<p> 所以npm run xxx 的时候，就会到 node_modules&#x2F;bin中找对应的映射文件，然后再找到相应的js文件来执行</p>
<p>1.查找规则是先从当前项目的node_modlue &#x2F;bin去找,</p>
<p>2.找不到去全局的node_module&#x2F;bin 去找</p>
<p>3.再找不到 去环境变量去找</p>
</blockquote>
<h2 id="2、常用-Composition-API组合式api"><a href="#2、常用-Composition-API组合式api" class="headerlink" title="2、常用 Composition API	组合式api"></a>2、常用 Composition API	组合式api</h2><p>官方文档: <a target="_blank" rel="noopener" href="https://v3.cn.vuejs.org/guide/composition-api-introduction.html">https://v3.cn.vuejs.org/guide/composition-api-introduction.html</a></p>
<h3 id="1-拉开序幕的setup"><a href="#1-拉开序幕的setup" class="headerlink" title="1.拉开序幕的setup"></a>1.拉开序幕的setup</h3><ul>
<li>setup 是 Vue3 中一个新的配置项，值为函数</li>
<li>组件中使用的数据、方法等都要配置在 setup 中</li>
<li>setup 函数两种返回值：<ul>
<li>返回一个对象，对象中的属性、方法可在模板中直接使用</li>
<li>返回一个渲染函数，可自定义渲染内容</li>
</ul>
</li>
<li>setup 函数的参数：<ul>
<li>props：值为对象，包含了组件外部传进来，且组件内部声明接收的属性</li>
<li>context：上下文对象<ul>
<li><code>attrs</code>：值为对象，包含了组件外部传进来，且组件内部没有声明接收的属性，相当于 <code>this.$attrs</code></li>
<li><code>slots</code>：收到的插槽内容，相当于 <code>this.$slots</code></li>
<li><code>emit</code>：触发自定义事件的函数，相当于 <code>this.$emit</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; h &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;App&#x27;</span>,<br>  <span class="hljs-attr">props</span>: [<span class="hljs-string">&#x27;title&#x27;</span>],<br>  <span class="hljs-comment">// Vue3 需要声明自定义事件，虽然不声明也能运行</span><br>  <span class="hljs-attr">emits</span>: [<span class="hljs-string">&#x27;changeCount&#x27;</span>],<br><br>  <span class="hljs-comment">// 返回函数</span><br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">  setup() &#123;</span><br><span class="hljs-comment">    return () =&gt; h(&#x27;h1&#x27;, &#x27;Hello&#x27;)</span><br><span class="hljs-comment">  &#125;,</span><br><span class="hljs-comment">  */</span><br><br>  <span class="hljs-comment">// 返回对象</span><br>  <span class="hljs-title function_">setup</span>(<span class="hljs-params">props, context</span>) &#123;<br>    <span class="hljs-keyword">let</span> name = <span class="hljs-string">&#x27;Vue3&#x27;</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">sayHello</span>(<span class="hljs-params"></span>) &#123;&#125;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"></span>) &#123;<br>      context.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;changeCount&#x27;</span>, <span class="hljs-number">888</span>)<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> &#123;<br>      name,<br>      sayHello,<br>      test,<br>    &#125;<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>setup 在 <code>beforeCreate</code> 钩子之前执行，<code>this</code> 为 <code>undefined</code></li>
<li>setup 不要和 Vue2 配置混用。Vue2 的配置可以访问到 setup 的属性方法，反过来不行；如有重名，setup 优先</li>
<li>setup 不能是 async 函数，因为 async 函数返回的是 promise 不是对象，会导致模板无法访问属性方法</li>
<li>若要返回 promise 实例，需要 <code>Suspense</code> 和异步组件的配合</li>
</ul>
<h3 id="2-ref函数"><a href="#2-ref函数" class="headerlink" title="2.ref函数"></a>2.ref函数</h3><ul>
<li>作用: 定义一个响应式的数据</li>
<li>语法: <code>const xxx = ref(initValue)</code> <ul>
<li>创建一个包含响应式数据的<strong style="color:#DD5145">引用对象（reference对象，简称ref对象）</strong>。</li>
<li>JS中操作数据： <code>xxx.value</code></li>
<li>模板中读取数据: 不需要.value，直接：<code>&lt;div&gt;&#123;&#123;xxx&#125;&#125;&lt;/div&gt;</code></li>
</ul>
</li>
<li>备注：<ul>
<li>接收的数据可以是：基本类型、也可以是<strong>对象类型</strong>。</li>
<li>基本类型的数据：响应式依然是靠<code>Object.defineProperty()</code>的<code>get</code>与<code>set</code>完成的。</li>
<li>对象类型的数据：内部 <i style="color:gray;font-weight:bold">“ 求助 ”</i> 了Vue3.0中的一个新函数—— <code>reactive</code>函数。</li>
<li>对象类型数据使用 ES6 的 <code>Proxy</code> 实现响应式，Vue3 把相关操作封装在 <code>reactive</code> 函数中</li>
<li>按照之前的办法，对于对象数据，应该遍历每一层的属性添加 <code>getter</code> 、<code>setter</code>，但 Vue3 使用 Proxy 把内部数据一口气监测了</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>&#123;&#123; name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;&#123; jobInfo.type &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">let</span> name = <span class="hljs-title function_">ref</span>(<span class="hljs-string">&#x27;Vue3&#x27;</span>)<br>    <span class="hljs-keyword">let</span> jobInfo = <span class="hljs-title function_">ref</span>(&#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;frontend&#x27;</span>,<br>      <span class="hljs-attr">salary</span>: <span class="hljs-string">&#x27;40w&#x27;</span>,<br>    &#125;)<br><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">changeInfo</span>(<span class="hljs-params"></span>) &#123;<br>      name.<span class="hljs-property">value</span> = <span class="hljs-string">&#x27;鱿鱼丝&#x27;</span><br>      <span class="hljs-comment">// jobInfo 是 RefImpl 实例</span><br>      <span class="hljs-comment">// jobInfo.value 是 Proxy 实例对象</span><br>      jobInfo.<span class="hljs-property">value</span>.<span class="hljs-property">salary</span> = <span class="hljs-string">&#x27;50w&#x27;</span><br>    &#125;<br><br>    <span class="hljs-keyword">return</span> &#123;<br>      name,<br>      jobInfo, <br>      changeInfo,<br>    &#125;<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-reactive函数"><a href="#3-reactive函数" class="headerlink" title="3.reactive函数"></a>3.reactive函数</h3><ul>
<li>作用: 定义一个<strong style="color:#DD5145">对象类型</strong>的响应式数据（基本类型不要用它，要用<code>ref</code>函数）</li>
<li>语法：<code>const 代理对象= reactive(源对象)</code>接收一个对象（或数组），返回一个<strong style="color:#DD5145">代理对象（Proxy的实例对象，简称proxy对象）</strong></li>
<li>reactive定义的响应式数据是“<strong>深层次的</strong>”。</li>
<li>内部基于 ES6 的 Proxy 实现，通过<strong>代理对象</strong>操作源对象内部数据进行操作。</li>
<li><code>reactive</code> <code>proxy</code> 不能直接赋值，否则会破坏响应式对象的<ul>
<li>解决方法： 数组可以使用push 加上 解构</li>
<li>添加一个对象，把数组作为一个属性去解决</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; reactive &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">let</span> person = <span class="hljs-title function_">reactive</span>(&#123;<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Vue3&#x27;</span>,<br>      <span class="hljs-attr">sex</span>: <span class="hljs-string">&#x27;unknown&#x27;</span>,<br>      <span class="hljs-attr">info</span>: &#123;<br>        <span class="hljs-attr">school</span>: <span class="hljs-string">&#x27;Oxford&#x27;</span>,<br>        <span class="hljs-attr">major</span>: <span class="hljs-string">&#x27;computer&#x27;</span>,<br>      &#125;,<br>    &#125;)<br><br>    <span class="hljs-keyword">let</span> color = <span class="hljs-title function_">reactive</span>([<span class="hljs-string">&#x27;red&#x27;</span>, <span class="hljs-string">&#x27;green&#x27;</span>, <span class="hljs-string">&#x27;blue&#x27;</span>])<br><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">changeInfo</span>(<span class="hljs-params"></span>) &#123;<br>      person.<span class="hljs-property">info</span>.<span class="hljs-property">major</span> = <span class="hljs-string">&#x27;art&#x27;</span><br>      color[<span class="hljs-number">0</span>] = <span class="hljs-string">&#x27;yellow&#x27;</span><br>    &#125;<br><br>    <span class="hljs-keyword">return</span> &#123;<br>      person,<br>      color,<br>      changeInfo,<br>    &#125;<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-Vue3-0中的响应式原理"><a href="#4-Vue3-0中的响应式原理" class="headerlink" title="4.Vue3.0中的响应式原理"></a>4.Vue3.0中的响应式原理</h3><h4 id="vue2-x的响应式"><a href="#vue2-x的响应式" class="headerlink" title="vue2.x的响应式"></a>vue2.x的响应式</h4><ul>
<li><p>实现原理：</p>
<ul>
<li><p>对象类型：通过<code>Object.defineProperty()</code>对属性的读取、修改进行拦截（数据劫持）。</p>
</li>
<li><p>数组类型：通过重写更新数组的一系列方法来实现拦截。（对数组的变更方法进行了包裹）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(data, <span class="hljs-string">&#x27;count&#x27;</span>, &#123;<br>    get () &#123;&#125;, <br>    set () &#123;&#125;<br>&#125;)<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>存在问题：</p>
<ul>
<li>新增属性、删除属性, 界面不会更新。</li>
<li>直接通过下标修改数组, 界面不会自动更新。</li>
</ul>
</li>
</ul>
<h4 id="Vue3-0的响应式"><a href="#Vue3-0的响应式" class="headerlink" title="Vue3.0的响应式"></a>Vue3.0的响应式</h4><ul>
<li><p>实现原理: </p>
<ul>
<li><p>通过<strong>Proxy（代理）</strong>:  <strong>拦截对象中任意属性的变化</strong>, 包括：属性值的读写、属性的添加、属性的删除等。</p>
</li>
<li><p>通过<strong>Reflect（反射）</strong>:  对源对象的属性进行操作。</p>
</li>
<li><p>MDN文档中描述的Proxy与Reflect：</p>
<ul>
<li><p>Proxy：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy</a></p>
</li>
<li><p>Reflect：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect</a></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(data, &#123;<br>	<span class="hljs-comment">// 拦截读取属性值	target:源对象	prop:属性</span><br>    get (target, prop) &#123;<br>    	<span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, prop)<br>    &#125;,<br>    <span class="hljs-comment">// 拦截设置属性值或添加新属性</span><br>    set (target, prop, value) &#123;<br>    	<span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, prop, value)<br>    &#125;,<br>    <span class="hljs-comment">// 拦截删除属性</span><br>    deleteProperty (target, prop) &#123;<br>    	<span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">deleteProperty</span>(target, prop)<br>    &#125;<br>&#125;)<br><br>proxy.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;tom&#x27;</span><br></code></pre></td></tr></table></figure>

<h3 id="5-reactive对比ref"><a href="#5-reactive对比ref" class="headerlink" title="5.reactive对比ref"></a>5.reactive对比ref</h3><ul>
<li>从定义数据角度对比：<ul>
<li>ref用来定义：<strong style="color:#DD5145">基本类型数据</strong>。</li>
<li>reactive用来定义：<strong style="color:#DD5145">对象（或数组）类型数据</strong>。</li>
<li>备注：ref也可以用来定义<strong style="color:#DD5145">对象（或数组）类型数据</strong>, 它内部会自动通过<code>reactive</code>转为<strong style="color:#DD5145">代理对象</strong>。</li>
</ul>
</li>
<li>从原理角度对比：<ul>
<li>ref通过<code>Object.defineProperty()</code>的<code>get</code>与<code>set</code>来实现响应式（数据劫持）。</li>
<li>reactive通过使用<strong style="color:#DD5145">Proxy</strong>来实现响应式（数据劫持）, 并通过<strong style="color:#DD5145">Reflect</strong>操作<strong style="color:orange">源对象</strong>内部的数据。</li>
</ul>
</li>
<li>从使用角度对比：<ul>
<li>ref定义的数据：操作数据<strong style="color:#DD5145">需要</strong><code>.value</code>，读取数据时模板中直接读取<strong style="color:#DD5145">不需要</strong><code>.value</code>。</li>
<li>reactive定义的数据：操作数据与读取数据：<strong style="color:#DD5145">均不需要</strong><code>.value</code>。</li>
</ul>
</li>
</ul>
<h3 id="6-setup的两个注意点"><a href="#6-setup的两个注意点" class="headerlink" title="6.setup的两个注意点"></a>6.setup的两个注意点</h3><ul>
<li><p>setup执行的时机</p>
<ul>
<li>在beforeCreate之前执行一次，<strong>this是undefined</strong>。</li>
<li>所以setup拿不到data的数据</li>
</ul>
</li>
<li><p>setup的参数</p>
<ul>
<li>props：值为对象，包含：组件外部传递过来，且组件内部声明接收了的属性。</li>
<li>context：<strong>上下文对象</strong><ul>
<li>attrs: 值为对象，包含：组件外部传递过来，但没有在props配置中声明的属性, 相当于 <code>this.$attrs</code>。</li>
<li>slots: 收到的插槽内容, 相当于 <code>this.$slots</code>。</li>
<li>emit: 分发自定义事件的函数, 相当于 <code>this.$emit</code>。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="7-计算属性与监视"><a href="#7-计算属性与监视" class="headerlink" title="7.计算属性与监视"></a>7.计算属性与监视</h3><h4 id="1-computed函数"><a href="#1-computed函数" class="headerlink" title="1.computed函数"></a>1.computed函数</h4><ul>
<li><p>与Vue2.x中computed配置功能一致</p>
</li>
<li><p>写法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;reavtive,computed&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><br><span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">let</span> person = <span class="hljs-title function_">reavtive</span>(&#123;<br>        <span class="hljs-attr">firstName</span>: <span class="hljs-string">&#x27;张&#x27;</span>,<br>        <span class="hljs-attr">lastName</span>: <span class="hljs-string">&#x27;三&#x27;</span><br>    &#125;)<br>	<span class="hljs-comment">//计算属性——简写（没有考虑计算属性被修改的情况）</span><br>    <span class="hljs-keyword">let</span> fullName = <span class="hljs-title function_">computed</span>(<span class="hljs-function">()=&gt;</span>&#123;<br>        <span class="hljs-keyword">return</span> person.<span class="hljs-property">firstName</span> + <span class="hljs-string">&#x27;-&#x27;</span> + person.<span class="hljs-property">lastName</span><br>    &#125;)<br>    <br>    <span class="hljs-comment">//也可以作为reactive的一个子项加入</span><br>    <span class="hljs-title class_">Person</span>.<span class="hljs-property">fullName</span> = <span class="hljs-title function_">computed</span>(<span class="hljs-function">()=&gt;</span>&#123;<br>        <span class="hljs-keyword">return</span> person.<span class="hljs-property">firstName</span> + <span class="hljs-string">&#x27;-&#x27;</span> + person.<span class="hljs-property">lastName</span><br>    &#125;)<br>    <span class="hljs-comment">//计算属性——完整（考虑到计算属性被修改的情况）</span><br>    <span class="hljs-keyword">let</span> fullName = <span class="hljs-title function_">computed</span>(&#123;<br>        <span class="hljs-title function_">get</span>(<span class="hljs-params"></span>)&#123;<br>            <span class="hljs-keyword">return</span> person.<span class="hljs-property">firstName</span> + <span class="hljs-string">&#x27;-&#x27;</span> + person.<span class="hljs-property">lastName</span><br>        &#125;,<br>        <span class="hljs-title function_">set</span>(<span class="hljs-params">value</span>)&#123;<br>            <span class="hljs-keyword">const</span> nameArr = value.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;-&#x27;</span>)<br>            person.<span class="hljs-property">firstName</span> = nameArr[<span class="hljs-number">0</span>]<br>            person.<span class="hljs-property">lastName</span> = nameArr[<span class="hljs-number">1</span>]<br>        &#125;<br>    &#125;)<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-watch函数"><a href="#2-watch函数" class="headerlink" title="2.watch函数"></a>2.watch函数</h4><ul>
<li><p>与Vue2.x中watch配置功能一致</p>
</li>
<li><p>两个小“坑”：</p>
<ul>
<li>监视reactive定义的响应式数据时：oldValue无法正确获取、强制开启了深度监视（deep配置失效）。</li>
<li>监视reactive定义的响应式数据中某个属性时：deep配置有效。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//情况一：监视ref定义的响应式数据</span><br><span class="hljs-title function_">watch</span>(sum,<span class="hljs-function">(<span class="hljs-params">newValue,oldValue</span>)=&gt;</span>&#123;<br>	<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;sum变化了&#x27;</span>,newValue,oldValue)<br>&#125;,&#123;<span class="hljs-attr">immediate</span>:<span class="hljs-literal">true</span>&#125;)<br><br><span class="hljs-comment">//情况二：监视多个ref定义的响应式数据</span><br><span class="hljs-title function_">watch</span>([sum,msg],<span class="hljs-function">(<span class="hljs-params">newValue,oldValue</span>)=&gt;</span>&#123;<br>	<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;sum或msg变化了&#x27;</span>,newValue,oldValue)<br>&#125;) <br><br><span class="hljs-comment">/* 情况三：监视reactive定义的响应式数据</span><br><span class="hljs-comment">	若watch监视的是reactive定义的响应式数据，则无法正确获得oldValue！！</span><br><span class="hljs-comment">	若watch监视的是reactive定义的响应式数据，则强制开启了深度监视 </span><br><span class="hljs-comment">*/</span><br><span class="hljs-title function_">watch</span>(person,<span class="hljs-function">(<span class="hljs-params">newValue,oldValue</span>)=&gt;</span>&#123;<br>	<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;person变化了&#x27;</span>,newValue,oldValue)<br>&#125;,&#123;<span class="hljs-attr">immediate</span>:<span class="hljs-literal">true</span>,<span class="hljs-attr">deep</span>:<span class="hljs-literal">false</span>&#125;) <span class="hljs-comment">//此处的deep配置不再奏效</span><br><br><span class="hljs-comment">//情况四：监视reactive定义的响应式数据中的某个属性</span><br><span class="hljs-title function_">watch</span>(<span class="hljs-function">()=&gt;</span>person.<span class="hljs-property">job</span>,<span class="hljs-function">(<span class="hljs-params">newValue,oldValue</span>)=&gt;</span>&#123;<br>	<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;person的job变化了&#x27;</span>,newValue,oldValue)<br>&#125;,&#123;<span class="hljs-attr">immediate</span>:<span class="hljs-literal">true</span>,<span class="hljs-attr">deep</span>:<span class="hljs-literal">true</span>&#125;) <br><br><span class="hljs-comment">//情况五：监视reactive定义的响应式数据中的某些属性</span><br><span class="hljs-title function_">watch</span>([<span class="hljs-function">()=&gt;</span>person.<span class="hljs-property">job</span>,<span class="hljs-function">()=&gt;</span>person.<span class="hljs-property">name</span>],<span class="hljs-function">(<span class="hljs-params">newValue,oldValue</span>)=&gt;</span>&#123;<br>	<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;person的job变化了&#x27;</span>,newValue,oldValue)<br>&#125;,&#123;<span class="hljs-attr">immediate</span>:<span class="hljs-literal">true</span>,<span class="hljs-attr">deep</span>:<span class="hljs-literal">true</span>&#125;)<br><br><span class="hljs-comment">//特殊情况</span><br><span class="hljs-title function_">watch</span>(<span class="hljs-function">()=&gt;</span>person.<span class="hljs-property">job</span>,<span class="hljs-function">(<span class="hljs-params">newValue,oldValue</span>)=&gt;</span>&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;person的job变化了&#x27;</span>,newValue,oldValue)<br>&#125;,&#123;<span class="hljs-attr">deep</span>:<span class="hljs-literal">true</span>&#125;) <span class="hljs-comment">//此处由于监视的是reactive所定义的对象中的某个属性，所以deep配置有效</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-watchEffect函数"><a href="#3-watchEffect函数" class="headerlink" title="3.watchEffect函数"></a>3.watchEffect函数</h4><ul>
<li><p>watch的套路是：既要指明监视的属性，也要指明监视的回调。</p>
</li>
<li><p>watchEffect的套路是：不用指明监视哪个属性，监视的回调中用到哪个属性，那就监视哪个属性。</p>
</li>
<li><p>watchEffect有点像computed：</p>
<ul>
<li>但computed注重的计算出来的值（回调函数的返回值），所以必须要写返回值。</li>
<li>而watchEffect更注重的是过程（回调函数的函数体），所以不用写返回值。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//watchEffect所指定的回调中用到的数据只要发生变化，则直接重新执行回调。</span><br><span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">()=&gt;</span>&#123;<br>    <span class="hljs-keyword">const</span> x1 = sum.<span class="hljs-property">value</span><br>    <span class="hljs-keyword">const</span> x2 = person.<span class="hljs-property">age</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;watchEffect配置的回调执行了&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="8-生命周期"><a href="#8-生命周期" class="headerlink" title="8.生命周期"></a>8.生命周期</h3><p>vue3的生命周期图:</p>
<p><img src="/../img/vue/lifecycle.16e4c08e.png" srcset="/img/loading.gif" lazyload alt="vue3生命周期图"></p>
<p>vue2生命周期图:</p>
<p><img src="/../img/vue/shengming.png" srcset="/img/loading.gif" lazyload alt="vue2生命周期图"></p>
<ul>
<li>Vue3.0中可以继续使用Vue2.x中的生命周期钩子，但有有两个被更名：<ul>
<li><code>beforeDestroy</code>改名为 <code>beforeUnmount</code></li>
<li><code>destroyed</code>改名为 <code>unmounted</code></li>
</ul>
</li>
<li>Vue3.0也提供了 Composition API 形式的生命周期钩子，与Vue2.x中钩子对应关系如下：<ul>
<li><code>beforeCreate</code>&#x3D;&#x3D;&#x3D;&gt;<code>setup()</code></li>
<li><code>created</code>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;<code>setup()</code></li>
<li><code>beforeMount</code> &#x3D;&#x3D;&#x3D;&gt;<code>onBeforeMount</code></li>
<li><code>mounted</code>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;<code>onMounted</code></li>
<li><code>beforeUpdate</code>&#x3D;&#x3D;&#x3D;&gt;<code>onBeforeUpdate</code></li>
<li><code>updated</code> &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;<code>onUpdated</code></li>
<li><code>beforeUnmount</code> &#x3D;&#x3D;&gt;<code>onBeforeUnmount</code></li>
<li><code>unmounted</code> &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;<code>onUnmounted</code></li>
<li><code>onErrorCaptured</code> &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;注册一个钩子，在捕获了后代组件传递的错误时调用。</li>
<li><code>onRenderTracked</code> &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; 注册一个调试钩子，当组件渲染过程中追踪到响应式依赖时调用。（仅在开发模式下可用）</li>
<li><code>onRenderTriggered</code> &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; 注册一个调试钩子，当响应式依赖的变更触发了组件渲染时调用。（仅在开发模式下可用）</li>
<li><code>onServerPrefetch</code> &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; 注册一个异步函数，在组件实例在服务器上被渲染之前调用。（仅在<strong>服务器端渲染期间</strong>可用）</li>
</ul>
</li>
</ul>
<h3 id="9-自定义hook函数"><a href="#9-自定义hook函数" class="headerlink" title="9.自定义hook函数"></a>9.自定义hook函数</h3><ul>
<li><p>什么是hook？—— 本质是一个函数，把setup函数中使用的Composition API进行了封装。</p>
</li>
<li><p>类似于vue2.x中的mixin。</p>
</li>
<li><p>自定义hook的优势: 复用代码, 让setup中的逻辑更清楚易懂。</p>
</li>
<li><p>hook 放在 hooks 文件夹中，一个文件对应一个功能模块，以 <code>useXxx</code> 命名</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// hooks/usePoint.js</span><br><span class="hljs-keyword">import</span> &#123; reactive, onMounted, onBeforeUnmount &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">//实现鼠标“打点”相关的数据</span><br>  <span class="hljs-keyword">let</span> point = <span class="hljs-title function_">reactive</span>(&#123;<br>    <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,<br>  &#125;)<br><br>  <span class="hljs-comment">//实现鼠标“打点”相关的方法</span><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">savePoint</span>(<span class="hljs-params">event</span>) &#123;<br>    point.<span class="hljs-property">x</span> = event.<span class="hljs-property">pageX</span><br>    point.<span class="hljs-property">y</span> = event.<span class="hljs-property">pageY</span><br>  &#125;<br><br>  <span class="hljs-comment">//实现鼠标“打点”相关的生命周期钩子</span><br>  <span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, savePoint)<br>  &#125;)<br><br>  <span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, savePoint)<br>  &#125;)<br><br>  <span class="hljs-keyword">return</span> point<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 使用 hook</span><br><span class="hljs-keyword">import</span> usePoint <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../hooks/usePoint.js&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">let</span> point = <span class="hljs-title function_">usePoint</span>()<br><br>    <span class="hljs-keyword">return</span> &#123; point &#125;<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br> <br> <br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Options</span> = &#123;<br>    <span class="hljs-attr">el</span>: <span class="hljs-built_in">string</span><br>&#125;<br> <br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Return</span> = &#123;<br>    <span class="hljs-title class_">Baseurl</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span><br>&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">option: Options</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Return</span>&gt; &#123;<br> <br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> &#123;<br>        <span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>            <span class="hljs-keyword">const</span> <span class="hljs-attr">file</span>: <span class="hljs-title class_">HTMLImageElement</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(option.<span class="hljs-property">el</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLImageElement</span>;<br>            file.<span class="hljs-property">onload</span> = ():<span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> &#123;<br>                <span class="hljs-title function_">resolve</span>(&#123;<br>                    <span class="hljs-title class_">Baseurl</span>: <span class="hljs-title function_">toBase64</span>(file)<br>                &#125;)<br>            &#125;<br> <br>        &#125;)<br> <br> <br>        <span class="hljs-keyword">const</span> toBase64 = (<span class="hljs-attr">el</span>: <span class="hljs-title class_">HTMLImageElement</span>): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> &#123;<br>            <span class="hljs-keyword">const</span> <span class="hljs-attr">canvas</span>: <span class="hljs-title class_">HTMLCanvasElement</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;canvas&#x27;</span>)<br>            <span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&#x27;2d&#x27;</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">CanvasRenderingContext2D</span><br>            canvas.<span class="hljs-property">width</span> = el.<span class="hljs-property">width</span><br>            canvas.<span class="hljs-property">height</span> = el.<span class="hljs-property">height</span><br>            ctx.<span class="hljs-title function_">drawImage</span>(el, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, canvas.<span class="hljs-property">width</span>,canvas.<span class="hljs-property">height</span>)<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(el.<span class="hljs-property">width</span>);<br>            <br>            <span class="hljs-keyword">return</span> canvas.<span class="hljs-title function_">toDataURL</span>(<span class="hljs-string">&#x27;image/png&#x27;</span>)<br> <br>        &#125;<br>    &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="案例二"><a href="#案例二" class="headerlink" title="案例二"></a>案例二</h4><p>自定义指令 + hooks 双管齐下</p>
<p>实现一个监听元素变化的hook</p>
<p>主要会用到一个新的API resizeObserver 兼容性一般 可以做polyfill</p>
<p>但是他可以监听元素的变化 执行回调函数 返回 contentRect 里面有变化之后的宽高。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">App</span>, defineComponent, onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br> <br><span class="hljs-keyword">function</span> <span class="hljs-title function_">useResize</span>(<span class="hljs-params">el: HTMLElement, callback: (cr: DOMRectReadOnly,resize:ResizeObserver) =&gt; <span class="hljs-built_in">void</span></span>) &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">resize</span>: <span class="hljs-title class_">ResizeObserver</span><br>        resize = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResizeObserver</span>(<span class="hljs-function">(<span class="hljs-params">entries</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> entry <span class="hljs-keyword">of</span> entries) &#123;<br>                <span class="hljs-keyword">const</span> cr = entry.<span class="hljs-property">contentRect</span>;<br>                <span class="hljs-title function_">callback</span>(cr,resize)<br>            &#125;<br>        &#125;);<br>        resize.<span class="hljs-title function_">observe</span>(el)<br>&#125;<br> <br> <br> <br><span class="hljs-keyword">const</span> <span class="hljs-title function_">install</span> = (<span class="hljs-params">app: App</span>) =&gt; &#123;<br>    app.<span class="hljs-title function_">directive</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, &#123;<br>        <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) &#123;<br>            <span class="hljs-title function_">useResize</span>(el, binding.<span class="hljs-property">value</span>)<br>        &#125;<br>    &#125;)<br>&#125;<br> <br>useResize.<span class="hljs-property">install</span> = install<br> <br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> useResize<br></code></pre></td></tr></table></figure>



<h3 id="10-toRef"><a href="#10-toRef" class="headerlink" title="10.toRef"></a>10.toRef</h3><ul>
<li><p>作用：创建一个 ref 对象，其value值指向另一个对象中的某个属性。</p>
</li>
<li><p>语法：<code>const name = toRef(person,&#39;name&#39;)</code></p>
</li>
<li><p>应用:   要将响应式对象中的某个属性单独提供给外部使用时。</p>
</li>
<li><p>只能修改响应式对象的值</p>
</li>
<li><p>使用场景：解构赋值，解构出来的也是响应式数据</p>
</li>
<li><p>扩展：<code>toRefs</code> 与<code>toRef</code>功能一致，但可以批量创建多个 ref 对象，语法：<code>toRefs(person)</code>   只能拆开</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;reactive, toRef, toRefs&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br>...<br><br><span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> person = <span class="hljs-title function_">reactive</span>(&#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Vue3&#x27;</span>,<br>    <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>,<br>    <span class="hljs-attr">info</span>: &#123;<br>      <span class="hljs-attr">job</span>: &#123;<br>        <span class="hljs-attr">salary</span>: <span class="hljs-number">40</span>,<br>      &#125;,<br>    &#125;,<br>  &#125;)<br><br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-comment">// 注意不能写成 ref(person.name)，这和源对象是割裂开的</span><br>    <span class="hljs-attr">name</span>: <span class="hljs-title function_">toRef</span>(person, <span class="hljs-string">&#x27;name&#x27;</span>),<br>    <span class="hljs-attr">salary</span>: <span class="hljs-title function_">toRef</span>(person.<span class="hljs-property">info</span>.<span class="hljs-property">job</span>, <span class="hljs-string">&#x27;salary&#x27;</span>)<br>    <span class="hljs-comment">// or</span><br>    ...<span class="hljs-title function_">toRefs</span>(person)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h2 id="3、其它-Composition-API"><a href="#3、其它-Composition-API" class="headerlink" title="3、其它 Composition API"></a>3、其它 Composition API</h2><h3 id="1-shallowReactive-与-shallowRef"><a href="#1-shallowReactive-与-shallowRef" class="headerlink" title="1.shallowReactive 与 shallowRef"></a>1.shallowReactive 与 shallowRef</h3><ul>
<li><p>shallowReactive：只处理对象最外层属性的响应式（浅响应式）。</p>
</li>
<li><p>shallowRef：只处理基本数据类型的响应式, 不进行对象的响应式处理。</p>
</li>
<li><p>什么时候使用?</p>
<ul>
<li>如果有一个对象数据，结构比较深, 但变化时只是外层属性变化 &#x3D;&#x3D;&#x3D;&gt; shallowReactive。</li>
<li>如果有一个对象数据，后续功能不会修改该对象中的属性，而是生新的对象来替换 &#x3D;&#x3D;&#x3D;&gt; shallowRef。</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; shallowReactive, shallowRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><br><span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> person = <span class="hljs-title function_">shallowReactive</span>(&#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Vue3&#x27;</span>,<br>    <span class="hljs-attr">age</span>: <span class="hljs-number">21</span>,<br>    <span class="hljs-attr">info</span>: &#123;<br>      <span class="hljs-attr">job</span>: &#123;<br>        <span class="hljs-attr">salary</span>: <span class="hljs-number">22</span><br>      &#125;<br>    &#125;<br>  &#125;)<br>  <span class="hljs-keyword">let</span> x = <span class="hljs-title function_">shallowRef</span>(&#123;<br>    <span class="hljs-attr">y</span>: <span class="hljs-number">0</span><br>  &#125;)<br>  <span class="hljs-keyword">return</span> &#123;<br>    person,<br>    x<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-readonly-与-shallowReadonly"><a href="#2-readonly-与-shallowReadonly" class="headerlink" title="2.readonly 与 shallowReadonly"></a>2.readonly 与 shallowReadonly</h3><ul>
<li>readonly: 让一个响应式数据变为只读的（深只读）。</li>
<li>shallowReadonly：让一个响应式数据变为只读的（浅只读）。浅层的数据不可以被修改，可以修改深层的数据</li>
<li>应用场景: 不希望数据被修改时。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> sum = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)<br>  <span class="hljs-keyword">let</span> person = <span class="hljs-title function_">reactive</span>(&#123;...&#125;)<br><br>  sum = <span class="hljs-title function_">readonly</span>(sum)<br>  person = <span class="hljs-title function_">shallowReadonly</span>(person)<br><br>  <span class="hljs-keyword">return</span> &#123;<br>    sum,<br>    person<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-toRaw-与-markRaw"><a href="#3-toRaw-与-markRaw" class="headerlink" title="3.toRaw 与 markRaw"></a>3.toRaw 与 markRaw</h3><ul>
<li>toRaw：<ul>
<li>作用：将一个由<code>reactive</code>生成的<strong style="color:orange">响应式对象</strong>转为<strong style="color:orange">普通对象</strong>。</li>
<li>使用场景：用于读取响应式对象对应的普通对象，对这个普通对象的所有操作，不会引起页面更新。</li>
</ul>
</li>
<li>markRaw：<ul>
<li>作用：标记一个对象，使其永远不会再成为响应式对象。</li>
<li>应用场景:<ol>
<li>有些值不应被设置为响应式的，例如复杂的第三方类库等。</li>
<li>当渲染具有不可变数据源的大列表时，跳过响应式转换可以提高性能。</li>
</ol>
</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">showRawPerson</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> p = <span class="hljs-title function_">toRaw</span>(person);<br>    p.<span class="hljs-property">age</span>++;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">addCar</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">let</span> car = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;奔驰&quot;</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">40</span> &#125;;<br>    person.<span class="hljs-property">car</span> = <span class="hljs-title function_">markRaw</span>(car);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-customRef"><a href="#4-customRef" class="headerlink" title="4.customRef"></a>4.customRef</h3><ul>
<li><p>作用：创建一个自定义的 ref，并对其依赖项跟踪和更新触发进行显式控制。</p>
</li>
<li><p>实现防抖效果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>	&lt;input type=&quot;text&quot; v-model=&quot;keyword&quot;&gt;<br>	&lt;h3&gt;&#123;&#123;keyword&#125;&#125;&lt;/h3&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>	import &#123;ref,customRef&#125; from &#x27;vue&#x27;<br>	export default &#123;<br>		name:&#x27;Demo&#x27;,<br>		setup()&#123;<br>			// let keyword = ref(&#x27;hello&#x27;) //使用Vue准备好的内置ref<br>			//自定义一个myRef	delay:延迟时间<br>			function myRef(value,delay)&#123;<br>				let timer<br>				//通过customRef去实现自定义<br>				return customRef((track,trigger)=&gt;&#123;<br>					return&#123;<br>						get()&#123;<br>							track() //告诉Vue这个value值是需要被“追踪”的<br>							return value<br>						&#125;,<br>						set(newValue)&#123;<br>							clearTimeout(timer)<br>							timer = setTimeout(()=&gt;&#123;<br>								value = newValue<br>								trigger() //告诉Vue去更新界面<br>							&#125;,delay)<br>						&#125;<br>					&#125;<br>				&#125;)<br>			&#125;<br>			let keyword = myRef(&#x27;hello&#x27;,500) //使用程序员自定义的ref<br>			return &#123;<br>				keyword<br>			&#125;<br>		&#125;<br>	&#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="5-provide-与-inject"><a href="#5-provide-与-inject" class="headerlink" title="5.provide 与 inject"></a>5.provide 与 inject</h3><p><img src="/../img/vue/provide-inject.840efd40.png" srcset="/img/loading.gif" lazyload alt="组件通信"></p>
<ul>
<li><p>作用：实现<strong style="color:#DD5145">祖与后代组件间</strong>通信</p>
</li>
<li><p>套路：父组件有一个 <code>provide</code> 选项来提供数据，后代组件有一个 <code>inject</code> 选项来开始使用这些数据</p>
</li>
<li><p>具体写法：</p>
<ol>
<li><p>祖组件中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>)&#123;<br>	......<br>    <span class="hljs-keyword">let</span> car = <span class="hljs-title function_">reactive</span>(&#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;奔驰&#x27;</span>,<span class="hljs-attr">price</span>:<span class="hljs-string">&#x27;40万&#x27;</span>&#125;)<br>    <span class="hljs-title function_">provide</span>(<span class="hljs-string">&#x27;car&#x27;</span>,car)<br>    ......<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>后代组件中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">setup</span>(<span class="hljs-params">props,context</span>)&#123;<br>	......<br>    <span class="hljs-keyword">const</span> car = <span class="hljs-title function_">inject</span>(<span class="hljs-string">&#x27;car&#x27;</span>)<br>    <span class="hljs-keyword">return</span> &#123;car&#125; <br>	......<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<blockquote>
<p>你如果传递普通的值 是不具有响应式的 需要通过ref reactive 添加响应式</p>
</blockquote>
<h3 id="6-响应式数据的判断"><a href="#6-响应式数据的判断" class="headerlink" title="6.响应式数据的判断"></a>6.响应式数据的判断</h3><ul>
<li>isRef: 检查一个值是否为一个 ref 对象</li>
<li>isReactive: 检查一个对象是否是由 <code>reactive</code> 创建的响应式代理</li>
<li>isReadonly: 检查一个对象是否是由 <code>readonly</code> 创建的只读代理</li>
<li>isProxy: 检查一个对象是否是由 <code>reactive</code> 或者 <code>readonly</code> 方法创建的代理</li>
</ul>
<h3 id="7、父子组件传参"><a href="#7、父子组件传参" class="headerlink" title="7、父子组件传参"></a>7、父子组件传参</h3><h4 id="父组件向子组件传值"><a href="#父组件向子组件传值" class="headerlink" title="父组件向子组件传值"></a>父组件向子组件传值</h4><p>父组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;children :data=&quot;name&quot;&gt;&lt;/children&gt;<br>&lt;/template&gt;<br><br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;<br>let name = &#x27;父组件&#x27;<br>&lt;/script&gt;<br><br></code></pre></td></tr></table></figure>

<p>子组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup lang=&#x27;ts&#x27;&gt;<br>// 接收父组件传过来的值 defineProps ts<br>const props = defineProps&lt;&#123; data: string &#125;&gt;()<br><br>// 添加默认值 ts<br>withDefaults(defineProps&lt;&#123;<br>  msg: string<br>&#125;&gt;(), &#123;<br>  msg: &#x27;Hello World&#x27;<br>&#125;)<br>    <br>// 接收父组件传过来的值 js<br>const props = defineProps(&#123;<br>  data: &#123;<br>    type: String,<br>    default: &#x27;default&#x27;<br>  &#125;<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<h4 id="子组件向父组件传值"><a href="#子组件向父组件传值" class="headerlink" title="子组件向父组件传值"></a>子组件向父组件传值</h4><p>父组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div&gt;父组件&lt;/div&gt;<br>  &lt;HelloWorld ref=&quot;world&quot; @update=&quot;getName&quot;/&gt;<br>&lt;/template&gt;<br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br>import &#123; ref,onMounted &#125; from &#x27;vue&#x27;<br>import HelloWorld from &#x27;./components/HelloWorld.vue&#x27;<br>const world = ref&lt;InstanceType&lt;typeof HelloWorld&gt;&gt;()<br>// 子组件向父组件传值<br>const getName = function(&#123;<br>    <br>&#125;)<br>// 在onMounted中调用子组件的方法<br>onMounted(() =&gt; &#123;<br>  world.value?.open()<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<p>子组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup lang=&#x27;ts&#x27;&gt;<br>// 给父组件传递数据 js写法<br>const emit = defineEmits([&#x27;update&#x27;])<br><br>// ts写法<br>const emit = defineEmits&lt;&#123;<br> (e: &#x27;update&#x27;, value: string): void<br>&#125;&gt;()<br><br>// 暴露属性和方法<br>defineExpose(&#123;<br>    name: &#x27;HelloWorld&#x27;,<br>    open:() =&gt; &#123;<br>        console.log(&#x27;HelloWorld&#x27;)<br>    &#125;<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<h4 id="案例封装瀑布流组件"><a href="#案例封装瀑布流组件" class="headerlink" title="案例	封装瀑布流组件"></a>案例	封装瀑布流组件</h4><p>父组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;waterFallVue :list=&quot;list&quot;&gt;&lt;/waterFallVue&gt;<br>&lt;/template&gt;<br><br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br>import &#123; ref, reactive &#125; from &#x27;vue&#x27;<br>import waterFallVue from &#x27;./components/water-fall.vue&#x27;;<br>const list = [<br>  &#123;<br>      height: 300,<br>      background: &#x27;red&#x27;<br>  &#125;,<br>  &#123;<br>      height: 400,<br>      background: &#x27;pink&#x27;<br>  &#125;,<br>  &#123;<br>      height: 500,<br>      background: &#x27;blue&#x27;<br>  &#125;,<br>  &#123;<br>      height: 200,<br>      background: &#x27;green&#x27;<br>  &#125;,<br>  &#123;<br>      height: 300,<br>      background: &#x27;gray&#x27;<br>  &#125;,<br>  &#123;<br>      height: 400,<br>      background: &#x27;#CC00FF&#x27;<br>  &#125;,<br>  &#123;<br>      height: 200,<br>      background: &#x27;black&#x27;<br>  &#125;,<br>  &#123;<br>      height: 100,<br>      background: &#x27;#996666&#x27;<br>  &#125;,<br>  &#123;<br>      height: 500,<br>      background: &#x27;skyblue&#x27;<br>  &#125;,<br>  &#123;<br>      height: 300,<br>      background: &#x27;#993366&#x27;<br>  &#125;,<br>  &#123;<br>      height: 100,<br>      background: &#x27;#33FF33&#x27;<br>  &#125;,<br>  &#123;<br>      height: 400,<br>      background: &#x27;skyblue&#x27;<br>  &#125;,<br>  &#123;<br>      height: 200,<br>      background: &#x27;#6633CC&#x27;<br>  &#125;,<br>  &#123;<br>      height: 300,<br>      background: &#x27;#666699&#x27;<br>  &#125;,<br>  &#123;<br>      height: 300,<br>      background: &#x27;#66CCFF&#x27;<br>  &#125;,<br>  &#123;<br>      height: 300,<br>      background: &#x27;skyblue&#x27;<br>  &#125;,<br>  &#123;<br>      height: 200,<br>      background: &#x27;#CC3366&#x27;<br>  &#125;,<br>  &#123;<br>      height: 200,<br>      background: &#x27;#CC9966&#x27;<br>  &#125;,<br>  &#123;<br>      height: 200,<br>      background: &#x27;#FF00FF&#x27;<br>  &#125;,<br>  &#123;<br>      height: 500,<br>      background: &#x27;#990000&#x27;<br>  &#125;,<br>  &#123;<br>      height: 400,<br>      background: &#x27;red&#x27;<br>  &#125;,<br>  &#123;<br>      height: 100,<br>      background: &#x27;#999966&#x27;<br>  &#125;,<br>  &#123;<br>      height: 200,<br>      background: &#x27;#CCCC66&#x27;<br>  &#125;,<br>  &#123;<br>      height: 300,<br>      background: &#x27;#FF33FF&#x27;<br>  &#125;,<br>  &#123;<br>      height: 400,<br>      background: &#x27;#FFFF66&#x27;<br>  &#125;,<br>  &#123;<br>      height: 200,<br>      background: &#x27;red&#x27;<br>  &#125;,<br>  &#123;<br>      height: 100,<br>      background: &#x27;skyblue&#x27;<br>  &#125;,<br>  &#123;<br>      height: 200,<br>      background: &#x27;#33CC00&#x27;<br>  &#125;,<br>  &#123;<br>      height: 300,<br>      background: &#x27;#330033&#x27;<br>  &#125;,<br>  &#123;<br>      height: 100,<br>      background: &#x27;#0066CC&#x27;<br>  &#125;,<br>  &#123;<br>      height: 200,<br>      background: &#x27;skyblue&#x27;<br>  &#125;,<br>  &#123;<br>      height: 100,<br>      background: &#x27;#006666&#x27;<br>  &#125;,<br>  &#123;<br>      height: 200,<br>      background: &#x27;yellow&#x27;<br>  &#125;,<br>  &#123;<br>      height: 300,<br>      background: &#x27;yellow&#x27;<br>  &#125;,<br>  &#123;<br>      height: 100,<br>      background: &#x27;#33CCFF&#x27;<br>  &#125;,<br>  &#123;<br>      height: 400,<br>      background: &#x27;yellow&#x27;<br>  &#125;,<br>  &#123;<br>      height: 400,<br>      background: &#x27;yellow&#x27;<br>  &#125;,<br>  &#123;<br>      height: 200,<br>      background: &#x27;#33FF00&#x27;<br>  &#125;,<br>  &#123;<br>      height: 300,<br>      background: &#x27;yellow&#x27;<br>  &#125;,<br>  &#123;<br>      height: 100,<br>      background: &#x27;green&#x27;<br>  &#125;<br><br>]<br>&lt;/script&gt;<br><br>&lt;style  lang=&#x27;less&#x27;&gt;<br>#app,<br>html,<br>body &#123;<br>  height: 100%;<br>&#125;<br><br>* &#123;<br>  padding: 0;<br>  margin: 0;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<p>子组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div class=&quot;wraps&quot;&gt;<br>        &lt;div :style=&quot;&#123;height:item.height+&#x27;px&#x27;,background:item.background,top:item.top+&#x27;px&#x27;,left:item.left + &#x27;px&#x27;&#125;&quot;<br>            v-for=&quot;item in waterList&quot; class=&quot;items&quot;&gt;&lt;/div&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br> <br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br>import &#123; ref, reactive, onMounted &#125; from &#x27;vue&#x27;<br>const props = defineProps&lt;&#123;<br>    list: any[]<br>&#125;&gt;()<br>const waterList = reactive&lt;any[]&gt;([])<br>const init = () =&gt; &#123;<br>    const heightList: any[] = []<br>    const width = 130;<br>    const x = document.body.clientWidth<br>    const column = Math.floor(x / width)<br> <br>    for (let i = 0; i &lt; props.list.length; i++) &#123;<br>        if (i &lt; column) &#123;<br>            props.list[i].top = 10;<br>            props.list[i].left = i * width;<br>            heightList.push(props.list[i].height + 10)<br>            waterList.push(props.list[i])<br>        &#125; else &#123;<br>            let current = heightList[0]<br>            let index = 0;<br>            heightList.forEach((h, inx) =&gt; &#123;<br>                if (current &gt; h) &#123;<br>                    current = h;<br>                    index = inx;<br>                &#125;<br>            &#125;)<br>            console.log(current,&#x27;c&#x27;)<br>            props.list[i].top = (current + 20);<br>            console.log(props.list[i].top,&#x27;top&#x27;,i)<br>            props.list[i].left = index * width;<br>            heightList[index] =  (heightList[index] + props.list[i].height + 20);<br>            waterList.push(props.list[i])<br>        <br>        &#125;<br>    &#125;<br>    console.log(props.list)<br>&#125;<br> <br>onMounted(() =&gt; &#123;<br>    window.onresize = () =&gt; init()<br>    init()<br>&#125;)<br> <br>&lt;/script&gt;<br> <br>&lt;style scoped lang=&#x27;less&#x27;&gt;<br>.wraps &#123;<br>    position: relative;<br>     height: 100%;<br>    .items &#123;<br>        position: absolute;<br>        width: 120px;<br>    &#125;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<h3 id="8、兄弟组件传参和bus"><a href="#8、兄弟组件传参和bus" class="headerlink" title="8、兄弟组件传参和bus"></a>8、兄弟组件传参和bus</h3><h4 id="借助父组件传参"><a href="#借助父组件传参" class="headerlink" title="借助父组件传参"></a>借助父组件传参</h4><p>例如父组件为App 子组件为A 和 B他两个是同级的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div&gt;<br>        &lt;A @on-click=&quot;getFalg&quot;&gt;&lt;/A&gt;<br>        &lt;B :flag=&quot;Flag&quot;&gt;&lt;/B&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br>    <br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br>import A from &#x27;./components/A.vue&#x27;<br>import B from &#x27;./components/B.vue&#x27;<br>import &#123; ref &#125; from &#x27;vue&#x27;<br>let Flag = ref&lt;boolean&gt;(false)<br>const getFalg = (flag: boolean) =&gt; &#123;<br>   Flag.value = flag;<br>&#125;<br>&lt;/script&gt;<br>    <br>&lt;style&gt;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<p>A 组件派发事件通过App.vue 接受A组件派发的事件然后在Props 传给B组件 也是可以实现的</p>
<p>缺点就是比较麻烦 ，无法直接通信，只能充当桥梁</p>
<h4 id="Event-Bus"><a href="#Event-Bus" class="headerlink" title="Event Bus"></a>Event Bus</h4><p>我们在<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Vue2&spm=1001.2101.3001.7020">Vue2</a> 可以使用$emit 传递 $on监听 emit传递过来的事件</p>
<p>这个原理其实是运用了<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=JS%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F&spm=1001.2101.3001.7020">JS设计模式</a>之发布订阅模式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs vue"> <br>type BusClass&lt;T&gt; = &#123;<br>    emit: (name: T) =&gt; void<br>    on: (name: T, callback: Function) =&gt; void<br>&#125;<br>type BusParams = string | number | symbol <br>type List = &#123;<br>    [key: BusParams]: Array&lt;Function&gt;<br>&#125;<br>class Bus&lt;T extends BusParams&gt; implements BusClass&lt;T&gt; &#123;<br>    list: List<br>    constructor() &#123;<br>        this.list = &#123;&#125;<br>    &#125;<br>    emit(name: T, ...args: Array&lt;any&gt;) &#123;<br>        let eventName: Array&lt;Function&gt; = this.list[name]<br>        eventName.forEach(ev =&gt; &#123;<br>            ev.apply(this, args)<br>        &#125;)<br>    &#125;<br>    on(name: T, callback: Function) &#123;<br>        let fn: Array&lt;Function&gt; = this.list[name] || [];<br>        fn.push(callback)<br>        this.list[name] = fn<br>    &#125;<br>&#125;<br> <br>export default new Bus&lt;number&gt;()<br></code></pre></td></tr></table></figure>

<p>然后挂载到Vue config 全局就可以使用啦</p>
<blockquote>
<p>注：在vue3当中，$on，$off，$once实例方法已被移除，组件实例不再实现事件触发接口，因此EventBus便无法使用</p>
<p>可以使用Mitt库实现</p>
</blockquote>
<h4 id="Mitt"><a href="#Mitt" class="headerlink" title="Mitt"></a>Mitt</h4><p>在vue3中$on，$off 和 $once 实例方法已被移除，组件实例不再实现事件触发接口，因此大家熟悉的EventBus便无法使用了。然而我们习惯了使用EventBus，对于这种情况我们可以使用Mitt库（其实就是我们视频中讲的发布订阅模式的设计）</p>
<h5 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a>1.安装</h5><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">npm <span class="hljs-keyword">install</span> mitt -S<br></code></pre></td></tr></table></figure>

<h5 id="2-main-ts-初始化"><a href="#2-main-ts-初始化" class="headerlink" title="2.main.ts 初始化"></a>2.main.ts 初始化</h5><p>全局总线，vue 入口文件 main.js 中挂载全局属性</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; createApp &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.vue&#x27;</span><br><span class="hljs-keyword">import</span> mitt <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mitt&#x27;</span><br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Mit</span> = <span class="hljs-title function_">mitt</span>()<br><br><span class="hljs-comment">//TypeScript注册</span><br><span class="hljs-comment">// 由于必须要拓展ComponentCustomProperties类型才能获得类型提示</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&quot;vue&quot;</span> &#123;<br>    <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ComponentCustomProperties</span> &#123;<br>        <span class="hljs-attr">$Bus</span>: <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Mit</span><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)<br><br><span class="hljs-comment">//Vue3挂载全局API</span><br>app.<span class="hljs-property">config</span>.<span class="hljs-property">globalProperties</span>.<span class="hljs-property">$Bus</span> = <span class="hljs-title class_">Mit</span><br><br>app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">&#x27;#app&#x27;</span>)<br></code></pre></td></tr></table></figure>

<h5 id="3使用方法通过emit派发，-on-方法添加事件，off-方法移除，clear-清空所有"><a href="#3使用方法通过emit派发，-on-方法添加事件，off-方法移除，clear-清空所有" class="headerlink" title="3使用方法通过emit派发， on 方法添加事件，off 方法移除，clear 清空所有"></a>3使用方法通过emit派发， on 方法添加事件，off 方法移除，clear 清空所有</h5><p>A组件派发（emit）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div&gt;<br>        &lt;h1&gt;我是A&lt;/h1&gt;<br>        &lt;button @click=&quot;emit1&quot;&gt;emit1&lt;/button&gt;<br>        &lt;button @click=&quot;emit2&quot;&gt;emit2&lt;/button&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br>import &#123; getCurrentInstance &#125; from &#x27;vue&#x27;<br>const instance = getCurrentInstance();<br>const emit1 = () =&gt; &#123;<br>    instance?.proxy?.$Bus.emit(&#x27;on-num&#x27;, 100)<br>&#125;<br>const emit2 = () =&gt; &#123;<br>    instance?.proxy?.$Bus.emit(&#x27;*****&#x27;, 500)<br>&#125;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>&lt;/style&gt; <br></code></pre></td></tr></table></figure>

<p>B组件监听（on）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div&gt;<br>        &lt;h1&gt;我是B&lt;/h1&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br>import &#123; getCurrentInstance &#125; from &#x27;vue&#x27;<br>const instance = getCurrentInstance()<br>instance?.proxy?.$Bus.on(&#x27;on-num&#x27;, (num) =&gt; &#123;<br>    console.log(num,&#x27;===========&gt;B&#x27;)<br>&#125;)<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<p>监听所有事件（ on(“*”) ）</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ts">instance?.<span class="hljs-property">proxy</span>?.<span class="hljs-property">$Bus</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;*&#x27;</span>,<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">type</span>,num</span>)=&gt;</span>&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">type</span>,num,<span class="hljs-string">&#x27;===========&gt;B&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>移除监听事件（off）</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Fn</span> = (<span class="hljs-params">num: <span class="hljs-built_in">any</span></span>) =&gt; &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num, <span class="hljs-string">&#x27;===========&gt;B&#x27;</span>)<br>&#125;<br>instance?.<span class="hljs-property">proxy</span>?.<span class="hljs-property">$Bus</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;on-num&#x27;</span>,<span class="hljs-title class_">Fn</span>)<span class="hljs-comment">//listen</span><br>instance?.<span class="hljs-property">proxy</span>?.<span class="hljs-property">$Bus</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">&#x27;on-num&#x27;</span>,<span class="hljs-title class_">Fn</span>)<span class="hljs-comment">//unListen</span><br></code></pre></td></tr></table></figure>

<p>清空所有监听（clear）</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ts">instance?.<span class="hljs-property">proxy</span>?.<span class="hljs-property">$Bus</span>.<span class="hljs-property">all</span>.<span class="hljs-title function_">clear</span>()<br></code></pre></td></tr></table></figure>

<h3 id="9、插槽"><a href="#9、插槽" class="headerlink" title="9、插槽"></a>9、插槽</h3><p>插槽就是子组件中的提供给父组件使用的一个占位符，用<slot></slot> 表示，父组件可以在这个占位符中填充任何模板代码，如 HTML、组件等，填充的内容会替换子组件的<slot></slot>标签。</p>
<h4 id="匿名插槽"><a href="#匿名插槽" class="headerlink" title="匿名插槽"></a>匿名插槽</h4><p>1.在子组件放置一个插槽</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div&gt;<br>       &lt;slot&gt;&lt;/slot&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>

<p>父组件使用插槽</p>
<p>在父组件给这个插槽填充内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;Dialog&gt;<br>   &lt;template v-slot&gt;<br>       &lt;div&gt;2132&lt;/div&gt;<br>   &lt;/template&gt;<br>&lt;/Dialog&gt;<br></code></pre></td></tr></table></figure>
<h4 id="具名插槽"><a href="#具名插槽" class="headerlink" title="具名插槽"></a>具名插槽</h4><p>具名插槽其实就是给插槽取个名字。一个子组件可以放多个插槽，而且可以放在不同的地方，而父组件填充内容时，可以根据这个名字把内容填充到对应插槽中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;div&gt;<br>    &lt;slot name=&quot;header&quot;&gt;&lt;/slot&gt;<br>    &lt;slot&gt;&lt;/slot&gt;<br> <br>    &lt;slot name=&quot;footer&quot;&gt;&lt;/slot&gt;<br>&lt;/div&gt;<br></code></pre></td></tr></table></figure>
<p>父组件使用需对应名称</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;Dialog&gt;<br>    &lt;template v-slot:header&gt;<br>       &lt;div&gt;1&lt;/div&gt;<br>   &lt;/template&gt;<br>   &lt;template v-slot&gt;<br>       &lt;div&gt;2&lt;/div&gt;<br>   &lt;/template&gt;<br>   &lt;template v-slot:footer&gt;<br>       &lt;div&gt;3&lt;/div&gt;<br>   &lt;/template&gt;<br>&lt;/Dialog&gt;<br></code></pre></td></tr></table></figure>
<p> 插槽简写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;Dialog&gt;<br>    &lt;template #header&gt;<br>       &lt;div&gt;1&lt;/div&gt;<br>   &lt;/template&gt;<br>   &lt;template #default&gt;<br>       &lt;div&gt;2&lt;/div&gt;<br>   &lt;/template&gt;<br>   &lt;template #footer&gt;<br>       &lt;div&gt;3&lt;/div&gt;<br>   &lt;/template&gt;<br>&lt;/Dialog&gt;<br></code></pre></td></tr></table></figure>
<h4 id="作用域插槽"><a href="#作用域插槽" class="headerlink" title="作用域插槽"></a>作用域插槽</h4><p>在子组件动态绑定参数 派发给父组件的slot去使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;div&gt;<br>    &lt;slot name=&quot;header&quot;&gt;&lt;/slot&gt;<br>    &lt;div&gt;<br>        &lt;div v-for=&quot;item in 100&quot;&gt;<br>            &lt;slot :data=&quot;item&quot;&gt;&lt;/slot&gt;<br>        &lt;/div&gt;<br>    &lt;/div&gt;<br> <br>    &lt;slot name=&quot;footer&quot;&gt;&lt;/slot&gt;<br>&lt;/div&gt;<br></code></pre></td></tr></table></figure>
<p>通过结构方式取值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs vue"> &lt;Dialog&gt;<br>    &lt;template #header&gt;<br>        &lt;div&gt;1&lt;/div&gt;<br>    &lt;/template&gt;<br>    &lt;template #default=&quot;&#123; data &#125;&quot;&gt;<br>        &lt;div&gt;&#123;&#123; data &#125;&#125;&lt;/div&gt;<br>    &lt;/template&gt;<br>    &lt;template #footer&gt;<br>        &lt;div&gt;3&lt;/div&gt;<br>    &lt;/template&gt;<br>&lt;/Dialog&gt;<br></code></pre></td></tr></table></figure>

<h4 id="动态插槽"><a href="#动态插槽" class="headerlink" title="动态插槽"></a>动态插槽</h4><p>插槽可以是一个变量名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;Dialog&gt;<br>    &lt;template #[name]&gt;<br>        &lt;div&gt;<br>            23<br>        &lt;/div&gt;<br>    &lt;/template&gt;<br>&lt;/Dialog&gt;<br></code></pre></td></tr></table></figure>
<h3 id="10、v-model"><a href="#10、v-model" class="headerlink" title="10、v-model"></a>10、v-model</h3><p>在Vue3 v-model 是破坏性更新的</p>
<p>v-model在组件里面也是很重要的</p>
<p>v-model 其实是一个语法糖 通过props 和 emit组合而成的</p>
<p>1.默认值的改变</p>
<ul>
<li><p>prop：value -&gt; modelValue；</p>
</li>
<li><p>事件：input -&gt; update:modelValue；</p>
</li>
<li><p>v-bind 的 .sync 修饰符和组件的 model 选项已移除</p>
</li>
<li><p>新增 支持多个v-model</p>
</li>
<li><p>新增 支持自定义 修饰符 Modifiers</p>
</li>
</ul>
<h4 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h4><p>子组件 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>     &lt;div v-if=&#x27;propData.modelValue &#x27; class=&quot;dialog&quot;&gt;<br>         &lt;div class=&quot;dialog-header&quot;&gt;<br>             &lt;div&gt;标题&lt;/div&gt;&lt;div @click=&quot;close&quot;&gt;x&lt;/div&gt;<br>         &lt;/div&gt;<br>         &lt;div class=&quot;dialog-content&quot;&gt;<br>            内容<br>         &lt;/div&gt;<br>         <br>     &lt;/div&gt;<br>&lt;/template&gt;<br> <br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br> <br>type Props = &#123;<br>   modelValue:boolean<br>&#125;<br> <br>const propData = defineProps&lt;Props&gt;()<br> <br>const emit = defineEmits([&#x27;update:modelValue&#x27;])<br> <br>const close = () =&gt; &#123;<br>     emit(&#x27;update:modelValue&#x27;,false)<br>&#125;<br> <br>&lt;/script&gt;<br> <br>&lt;style lang=&#x27;less&#x27;&gt;<br>.dialog&#123;<br>    width: 300px;<br>    height: 300px;<br>    border: 1px solid #ccc;<br>    position: fixed;<br>    left:50%;<br>    top:50%;<br>    transform: translate(-50%,-50%);<br>    &amp;-header&#123;<br>        border-bottom: 1px solid #ccc;<br>        display: flex;<br>        justify-content: space-between;<br>        padding: 10px;<br>    &#125;<br>    &amp;-content&#123;<br>        padding: 10px;<br>    &#125;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<p>父组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;button @click=&quot;show = !show&quot;&gt;开关&#123;&#123;show&#125;&#125;&lt;/button&gt;<br>  &lt;Dialog v-model=&quot;show&quot;&gt;&lt;/Dialog&gt;<br>&lt;/template&gt;<br> <br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br>import Dialog from &quot;./components/Dialog/index.vue&quot;;<br>import &#123;ref&#125; from &#x27;vue&#x27;<br>const show = ref(false)<br>&lt;/script&gt;<br> <br>&lt;style&gt;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<h4 id="绑定多个案例"><a href="#绑定多个案例" class="headerlink" title="绑定多个案例"></a>绑定多个案例</h4><p> 子组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>     &lt;div v-if=&#x27;modelValue &#x27; class=&quot;dialog&quot;&gt;<br>         &lt;div class=&quot;dialog-header&quot;&gt;<br>             &lt;div&gt;标题---&#123;&#123;title&#125;&#125;&lt;/div&gt;&lt;div @click=&quot;close&quot;&gt;x&lt;/div&gt;<br>         &lt;/div&gt;<br>         &lt;div class=&quot;dialog-content&quot;&gt;<br>            内容<br>         &lt;/div&gt;<br>         <br>     &lt;/div&gt;<br>&lt;/template&gt;<br> <br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br> <br>type Props = &#123;<br>   modelValue:boolean,<br>   title:string<br>&#125;<br> <br>const propData = defineProps&lt;Props&gt;()<br> <br>const emit = defineEmits([&#x27;update:modelValue&#x27;,&#x27;update:title&#x27;])<br> <br>const close = () =&gt; &#123;<br>     emit(&#x27;update:modelValue&#x27;,false)<br>     emit(&#x27;update:title&#x27;,&#x27;我要改变&#x27;)<br>&#125;<br> <br>&lt;/script&gt;<br> <br>&lt;style lang=&#x27;less&#x27;&gt;<br>.dialog&#123;<br>    width: 300px;<br>    height: 300px;<br>    border: 1px solid #ccc;<br>    position: fixed;<br>    left:50%;<br>    top:50%;<br>    transform: translate(-50%,-50%);<br>    &amp;-header&#123;<br>        border-bottom: 1px solid #ccc;<br>        display: flex;<br>        justify-content: space-between;<br>        padding: 10px;<br>    &#125;<br>    &amp;-content&#123;<br>        padding: 10px;<br>    &#125;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<p>父组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;button @click=&quot;show = !show&quot;&gt;开关&#123;&#123;show&#125;&#125; ----- &#123;&#123;title&#125;&#125;&lt;/button&gt;<br>  &lt;Dialog v-model:title=&#x27;title&#x27; v-model=&quot;show&quot;&gt;&lt;/Dialog&gt;<br>&lt;/template&gt;<br> <br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br>import Dialog from &quot;./components/Dialog/index.vue&quot;;<br>import &#123;ref&#125; from &#x27;vue&#x27;<br>const show = ref(false)<br>const title = ref(&#x27;我是标题&#x27;)<br>&lt;/script&gt;<br> <br>&lt;style&gt;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<h4 id="自定义修饰符"><a href="#自定义修饰符" class="headerlink" title="自定义修饰符"></a>自定义修饰符</h4><p>添加到组件 <code>v-model</code> 的修饰符将通过 <code>modelModifiers</code> prop 提供给组件。在下面的示例中，我们创建了一个组件，其中包含默认为空对象的 <code>modelModifiers</code> prop</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup lang=&#x27;ts&#x27;&gt;<br> <br>type Props = &#123;<br>    modelValue: boolean,<br>    title?: string,<br>    modelModifiers?: &#123;<br>        default: () =&gt; &#123;&#125;<br>    &#125;<br>    titleModifiers?: &#123;<br>        default: () =&gt; &#123;&#125;<br>    &#125;<br> <br>&#125;<br> <br>const propData = defineProps&lt;Props&gt;()<br> <br>const emit = defineEmits([&#x27;update:modelValue&#x27;, &#x27;update:title&#x27;])<br> <br>const close = () =&gt; &#123;<br>    console.log(propData.modelModifiers);<br> <br>    emit(&#x27;update:modelValue&#x27;, false)<br>    emit(&#x27;update:title&#x27;, &#x27;我要改变&#x27;)<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="11、自定义指令directive"><a href="#11、自定义指令directive" class="headerlink" title="11、自定义指令directive"></a>11、自定义指令directive</h3><blockquote>
<p>属于破坏性更新</p>
</blockquote>
<h4 id="1-Vue3指令的钩子函数"><a href="#1-Vue3指令的钩子函数" class="headerlink" title="1.Vue3指令的钩子函数"></a>1.Vue3指令的钩子函数</h4><ul>
<li>created 元素初始化的时候</li>
<li>beforeMount 指令绑定到元素后调用 只调用一次</li>
<li>mounted 元素插入父级dom调用</li>
<li>beforeUpdate 元素被更新之前调用</li>
<li>update 这个周期方法被移除 改用updated</li>
<li>beforeUnmount 在元素被移除前调用</li>
<li>unmounted 指令被移除后调用 只调用一次</li>
</ul>
<p>Vue2 指令 bind inserted update componentUpdated unbind</p>
<h4 id="2-在setup内定义局部指令"><a href="#2-在setup内定义局部指令" class="headerlink" title="2.在setup内定义局部指令"></a>2.在setup内定义局部指令</h4><p>但这里有一个需要注意的限制：必须以 <code>vNameOfDirective</code> 的形式来命名本地自定义指令，以使得它们可以直接在模板中使用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;button @click=&quot;show = !show&quot;&gt;开关&#123;&#123;show&#125;&#125; ----- &#123;&#123;title&#125;&#125;&lt;/button&gt;<br>  &lt;Dialog  v-move-directive=&quot;&#123;background:&#x27;green&#x27;,flag:show&#125;&quot;&gt;&lt;/Dialog&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs ts"> <br><span class="hljs-keyword">const</span> <span class="hljs-attr">vMoveDirective</span>: <span class="hljs-title class_">Directive</span> = &#123;<br>  <span class="hljs-attr">created</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;初始化====&gt;&quot;</span>);<br>  &#125;,<br>  <span class="hljs-title function_">beforeMount</span>(<span class="hljs-params">...args: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">any</span>&gt;</span>) &#123;<br>    <span class="hljs-comment">// 在元素上做些操作</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;初始化一次=======&gt;&quot;</span>);<br>  &#125;,<br>  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el: <span class="hljs-built_in">any</span>, dir: DirectiveBinding&lt;Value&gt;</span>) &#123;<br>    el.<span class="hljs-property">style</span>.<span class="hljs-property">background</span> = dir.<span class="hljs-property">value</span>.<span class="hljs-property">background</span>;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;初始化========&gt;&quot;</span>);<br>  &#125;,<br>  <span class="hljs-title function_">beforeUpdate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;更新之前&quot;</span>);<br>  &#125;,<br>  <span class="hljs-title function_">updated</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;更新结束&quot;</span>);<br>  &#125;,<br>  <span class="hljs-title function_">beforeUnmount</span>(<span class="hljs-params">...args: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">any</span>&gt;</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(args);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;======&gt;卸载之前&quot;</span>);<br>  &#125;,<br>  <span class="hljs-title function_">unmounted</span>(<span class="hljs-params">...args: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">any</span>&gt;</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(args);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;======&gt;卸载完成&quot;</span>);<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure>

<h4 id="3-生命周期钩子参数详解"><a href="#3-生命周期钩子参数详解" class="headerlink" title="3.生命周期钩子参数详解"></a>3.生命周期钩子参数详解</h4><p>第一个 el  当前绑定的DOM 元素</p>
<p>第二个 binding</p>
<ul>
<li>instance：使用指令的组件实例。</li>
<li>value：传递给指令的值。例如，在 v-my-directive&#x3D;”1 + 1” 中，该值为 2。</li>
<li>oldValue：先前的值，仅在 beforeUpdate 和 updated 中可用。无论值是否有更改都可用。</li>
<li>arg：传递给指令的参数(如果有的话)。例如在 v-my-directive:foo 中，arg 为 “foo”。</li>
<li>modifiers：包含修饰符(如果有的话) 的对象。例如在 v-my-directive.foo.bar 中，修饰符对象为 {foo: true，bar: true}。</li>
<li>dir：一个对象，在注册指令时作为参数传递。例如，在以下指令中</li>
</ul>
<p><img src="/../img/vue/f9e5558801104f81ac32c54d6cf5f587.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>第三个 当前元素的虚拟DOM 也就是Vnode</p>
<p>第四个 prevNode 上一个虚拟节点，仅在 beforeUpdate 和 updated 钩子中可用 </p>
<h4 id="4-函数简写"><a href="#4-函数简写" class="headerlink" title="4.函数简写"></a>4.函数简写</h4><p>你可能想在 <code>mounted</code> 和 <code>updated</code> 时触发相同行为，而不关心其他的钩子函数。那么你可以通过将这个函数模式实现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   &lt;div&gt;<br>      &lt;input v-model=&quot;value&quot; type=&quot;text&quot; /&gt;<br>      &lt;A v-move=&quot;&#123; background: value &#125;&quot;&gt;&lt;/A&gt;<br>   &lt;/div&gt;<br>&lt;/template&gt;<br>   <br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br>import A from &#x27;./components/A.vue&#x27;<br>import &#123; ref, Directive, DirectiveBinding &#125; from &#x27;vue&#x27;<br>let value = ref&lt;string&gt;(&#x27;&#x27;)<br>type Dir = &#123;<br>   background: string<br>&#125;<br>const vMove: Directive = (el, binding: DirectiveBinding&lt;Dir&gt;) =&gt; &#123;<br>   el.style.background = binding.value.background<br>&#125;<br>&lt;/script&gt;<br> <br>&lt;style&gt;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<h5 id="1-案例自定义拖拽指令"><a href="#1-案例自定义拖拽指令" class="headerlink" title="1.案例自定义拖拽指令"></a>1.案例自定义拖拽指令</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div v-move class=&quot;box&quot;&gt;<br>    &lt;div class=&quot;header&quot;&gt;&lt;/div&gt;<br>    &lt;div&gt;<br>      内容<br>    &lt;/div&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br> <br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br>import &#123; Directive &#125; from &quot;vue&quot;;<br>const vMove: Directive = &#123;<br>  mounted(el: HTMLElement) &#123;<br>    let moveEl = el.firstElementChild as HTMLElement;<br>    const mouseDown = (e: MouseEvent) =&gt; &#123;<br>      //鼠标点击物体那一刻相对于物体左侧边框的距离=点击时的位置相对于浏览器最左边的距离-物体左边框相对于浏览器最左边的距离<br>      console.log(e.clientX, e.clientY, &quot;-----起始&quot;, el.offsetLeft);<br>      let X = e.clientX - el.offsetLeft;<br>      let Y = e.clientY - el.offsetTop;<br>      const move = (e: MouseEvent) =&gt; &#123;<br>        el.style.left = e.clientX - X + &quot;px&quot;;<br>        el.style.top = e.clientY - Y + &quot;px&quot;;<br>        console.log(e.clientX, e.clientY, &quot;---改变&quot;);<br>      &#125;;<br>      document.addEventListener(&quot;mousemove&quot;, move);<br>      document.addEventListener(&quot;mouseup&quot;, () =&gt; &#123;<br>        document.removeEventListener(&quot;mousemove&quot;, move);<br>      &#125;);<br>    &#125;;<br>    moveEl.addEventListener(&quot;mousedown&quot;, mouseDown);<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br> <br>&lt;style lang=&#x27;less&#x27;&gt;<br>.box &#123;<br>  position: fixed;<br>  left: 50%;<br>  top: 50%;<br>  transform: translate(-50%, -50%);<br>  width: 200px;<br>  height: 200px;<br>  border: 1px solid #ccc;<br>  .header &#123;<br>    height: 20px;<br>    background: black;<br>    cursor: move;<br>  &#125;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<h5 id="2-案例权限按钮"><a href="#2-案例权限按钮" class="headerlink" title="2.案例权限按钮"></a>2.案例权限按钮</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   &lt;div class=&quot;btns&quot;&gt;<br>       &lt;button v-has-show=&quot;&#x27;shop:create&#x27;&quot;&gt;创建&lt;/button&gt;<br> <br>       &lt;button v-has-show=&quot;&#x27;shop:edit&#x27;&quot;&gt;编辑&lt;/button&gt;<br> <br>       &lt;button v-has-show=&quot;&#x27;shop:delete&#x27;&quot;&gt;删除&lt;/button&gt;<br>   &lt;/div&gt;<br>&lt;/template&gt;<br> <br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br>import &#123; ref, reactive,  &#125; from &#x27;vue&#x27;<br>import type &#123;Directive&#125; from &#x27;vue&#x27;<br>//permission<br>localStorage.setItem(&#x27;userId&#x27;,&#x27;xiaoman-zs&#x27;)<br> <br>//mock后台返回的数据<br>const permission = [<br>    &#x27;xiaoman-zs:shop:edit&#x27;,<br>    &#x27;xiaoman-zs:shop:create&#x27;,<br>    &#x27;xiaoman-zs:shop:delete&#x27;<br>]<br>const userId = localStorage.getItem(&#x27;userId&#x27;) as string<br>const vHasShow:Directive&lt;HTMLElement,string&gt; = (el,bingding) =&gt; &#123;<br>   if(!permission.includes(userId+&#x27;:&#x27;+ bingding.value))&#123;<br>       el.style.display = &#x27;none&#x27;<br>   &#125;<br>&#125;<br> <br>&lt;/script&gt;<br> <br>&lt;style scoped lang=&#x27;less&#x27;&gt;<br>.btns&#123;<br>    button&#123;<br>        margin: 10px;<br>    &#125;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<h5 id="3-图片懒加载"><a href="#3-图片懒加载" class="headerlink" title="3.图片懒加载"></a>3.图片懒加载</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div&gt;<br>        &lt;div v-for=&quot;item in arr&quot;&gt;<br>            &lt;img height=&quot;500&quot; :data-index=&quot;item&quot; v-lazy=&quot;item&quot; width=&quot;360&quot; alt=&quot;&quot;&gt;<br>        &lt;/div&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br> <br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br>import &#123; ref, reactive &#125; from &#x27;vue&#x27;<br>import type &#123; Directive &#125; from &#x27;vue&#x27;<br>const images: Record&lt;string, &#123; default: string &#125;&gt; = import.meta.globEager(&#x27;./assets/images/*.*&#x27;)<br>let arr = Object.values(images).map(v =&gt; v.default)<br> <br>let vLazy: Directive&lt;HTMLImageElement, string&gt; = async (el, binding) =&gt; &#123;<br>    let url = await import(&#x27;./assets/vue.svg&#x27;)<br>    el.src = url.default;<br>    let observer = new IntersectionObserver((entries) =&gt; &#123;<br>        console.log(entries[0], el)<br>        if (entries[0].intersectionRatio &gt; 0 &amp;&amp; entries[0].isIntersecting) &#123;<br>            setTimeout(() =&gt; &#123;<br>                el.src = binding.value;<br>                observer.unobserve(el)<br>            &#125;, 2000)<br>        &#125;<br>    &#125;)<br>    observer.observe(el)<br>&#125;<br> <br>&lt;/script&gt;<br> <br>&lt;style scoped lang=&#x27;less&#x27;&gt;&lt;/style&gt;<br></code></pre></td></tr></table></figure>



<h2 id="4、Composition-API-的优势"><a href="#4、Composition-API-的优势" class="headerlink" title="4、Composition API 的优势"></a>4、Composition API 的优势</h2><h3 id="1-Options-API-存在的问题"><a href="#1-Options-API-存在的问题" class="headerlink" title="1.Options API 存在的问题"></a>1.Options API 存在的问题</h3><p>使用传统OptionsAPI中，新增或者修改一个需求，就需要分别在data，methods，computed里修改 。</p>
<div style="width:600px;height:370px;overflow:hidden;float:left">
    <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f84e4e2c02424d9a99862ade0a2e4114~tplv-k3u1fbpfcp-watermark.image" srcset="/img/loading.gif" lazyload style="width:600px;float:left" />
</div>
<div style="width:300px;height:370px;overflow:hidden;float:left">
    <img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e5ac7e20d1784887a826f6360768a368~tplv-k3u1fbpfcp-watermark.image" srcset="/img/loading.gif" lazyload style="zoom:50%;width:560px;left" /> 
</div>




















<h3 id="2-Composition-API-的优势"><a href="#2-Composition-API-的优势" class="headerlink" title="2.Composition API 的优势"></a>2.Composition API 的优势</h3><p>我们可以更加优雅的组织我们的代码，函数。让相关功能的代码更加有序的组织在一起。</p>
<div style="width:400px;height:300px;overflow:hidden;float:left">
    <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc0be8211fc54b6c941c036791ba4efe~tplv-k3u1fbpfcp-watermark.image" srcset="/img/loading.gif" lazyloadstyle="height:360px"/>
</div>
<div style="width:430px;height:340px;overflow:hidden;float:left">
    <img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6cc55165c0e34069a75fe36f8712eb80~tplv-k3u1fbpfcp-watermark.image" srcset="/img/loading.gif" lazyloadstyle="height:360px"/>
</div>





















<h2 id="5、新的组件"><a href="#5、新的组件" class="headerlink" title="5、新的组件"></a>5、新的组件</h2><h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><h4 id="全局组件"><a href="#全局组件" class="headerlink" title="全局组件"></a>全局组件</h4><p>在main.ts文件中</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Card</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/Card.vue&#x27;</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)<br>app.<span class="hljs-title function_">component</span>(<span class="hljs-string">&#x27;Card&#x27;</span>, <span class="hljs-title class_">Card</span>)<br></code></pre></td></tr></table></figure>

<h4 id="局部组件"><a href="#局部组件" class="headerlink" title="局部组件"></a>局部组件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div&gt;&lt;/div&gt;<br>  &lt;Card content=&#x27;123&#x27;&gt;&lt;/Card&gt;<br>&lt;/template&gt;<br><br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;<br>import Card from &#x27;./components/Card.vue&#x27;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br><br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<h4 id="递归组件"><a href="#递归组件" class="headerlink" title="递归组件"></a>递归组件</h4><p>父组件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> <span class="hljs-title class_">TreeList</span> = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;<br>  icon?: <span class="hljs-built_in">string</span>;<br>  children?: <span class="hljs-title class_">TreeList</span>[] | [];<br>&#125;;<br><span class="hljs-keyword">const</span> data = reactive&lt;<span class="hljs-title class_">TreeList</span>[]&gt;([<br>  &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;no.1&quot;</span>,<br>    <span class="hljs-attr">children</span>: [<br>      &#123;<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;no.1-1&quot;</span>,<br>        <span class="hljs-attr">children</span>: [<br>          &#123;<br>            <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;no.1-1-1&quot;</span>,<br>          &#125;,<br>        ],<br>      &#125;,<br>    ],<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;no.2&quot;</span>,<br>    <span class="hljs-attr">children</span>: [<br>      &#123;<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;no.2-1&quot;</span>,<br>      &#125;,<br>    ],<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;no.3&quot;</span>,<br>  &#125;,<br>]);<br></code></pre></td></tr></table></figure>

<p>子组件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> <span class="hljs-title class_">TreeList</span> = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;<br>  icon?: <span class="hljs-built_in">string</span>;<br>  children?: <span class="hljs-title class_">TreeList</span>[] | [];<br>&#125;;<br> <br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Props</span>&lt;T&gt; = &#123;<br>  data?: T[] | [];<br>&#125;;<br> <br>defineProps&lt;<span class="hljs-title class_">Props</span>&lt;<span class="hljs-title class_">TreeList</span>&gt;&gt;();<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">clickItem</span> = (<span class="hljs-params">item: TreeList</span>) =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item)<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>子组件增加一个script 定义组件名称为了 递归用</strong> </p>
<p><strong>给我们的组件定义名称有好几种方式</strong></p>
<h5 id="1、在增加一个script-通过-export-添加name"><a href="#1、在增加一个script-通过-export-添加name" class="headerlink" title="1、在增加一个script 通过 export 添加name"></a>1、在增加一个script 通过 export 添加name</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script lang=&quot;ts&quot;&gt;<br>export default &#123;<br>  name:&quot;TreeItem&quot;<br>&#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<h5 id="2、直接使用文件名当组件名"><a href="#2、直接使用文件名当组件名" class="headerlink" title="2、直接使用文件名当组件名"></a>2、直接使用文件名当组件名</h5><p>3、在script加上name</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script lang=&quot;ts&quot; name=&quot;TreeItem&quot;&gt;<br><br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<h3 id="动态组件"><a href="#动态组件" class="headerlink" title="动态组件"></a>动态组件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;component :is=&quot;A&quot;&gt;&lt;/component&gt;<br><br>import A from &#x27;./A.vue&#x27;<br>import B from &#x27;./B.vue&#x27;<br></code></pre></td></tr></table></figure>

<h3 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h3><p>插件是自包含的代码，通常向 Vue 添加全局级功能。你如果是一个对象需要有install方法Vue会帮你自动注入到install 方法 你如果是function 就直接当install 方法去使用</p>
<h4 id="使用插件"><a href="#使用插件" class="headerlink" title="使用插件"></a>使用插件</h4><p>在使用 <code>createApp()</code> 初始化 Vue 应用程序后，你可以通过调用 <code>use()</code> 方法将插件添加到你的应用程序中。</p>
<p><strong>实现一个Loading</strong></p>
<h5 id="Loading-Vue"><a href="#Loading-Vue" class="headerlink" title="Loading.Vue"></a>Loading.Vue</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div v-if=&quot;isShow&quot; class=&quot;loading&quot;&gt;<br>        &lt;div class=&quot;loading-content&quot;&gt;Loading...&lt;/div&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br>    <br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;;<br>const isShow = ref(false)//定位loading 的开关<br> <br>const show = () =&gt; &#123;<br>    isShow.value = true<br>&#125;<br>const hide = () =&gt; &#123;<br>    isShow.value = false<br>&#125;<br>//对外暴露 当前组件的属性和方法<br>defineExpose(&#123;<br>    isShow,<br>    show,<br>    hide<br>&#125;)<br>&lt;/script&gt;<br> <br> <br>    <br>&lt;style scoped lang=&quot;less&quot;&gt;<br>.loading &#123;<br>    position: fixed;<br>    inset: 0;<br>    background: rgba(0, 0, 0, 0.8);<br>    display: flex;<br>    justify-content: center;<br>    align-items: center;<br>    &amp;-content &#123;<br>        font-size: 30px;<br>        color: #fff;<br>    &#125;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<h5 id="Loading-ts"><a href="#Loading-ts" class="headerlink" title="Loading.ts"></a>Loading.ts</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123;  createVNode, render, <span class="hljs-title class_">VNode</span>, <span class="hljs-title class_">App</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Loading</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./index.vue&#x27;</span><br> <br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>    <span class="hljs-title function_">install</span>(<span class="hljs-params">app: App</span>) &#123;<br>        <span class="hljs-comment">//createVNode vue提供的底层方法 可以给我们组件创建一个虚拟DOM 也就是Vnode</span><br>        <span class="hljs-keyword">const</span> <span class="hljs-attr">vnode</span>: <span class="hljs-title class_">VNode</span> = <span class="hljs-title function_">createVNode</span>(<span class="hljs-title class_">Loading</span>)<br>        <span class="hljs-comment">//render 把我们的Vnode 生成真实DOM 并且挂载到指定节点</span><br>        <span class="hljs-title function_">render</span>(vnode, <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>)<br>        <span class="hljs-comment">// Vue 提供的全局配置 可以自定义</span><br>        app.<span class="hljs-property">config</span>.<span class="hljs-property">globalProperties</span>.<span class="hljs-property">$loading</span> = &#123;<br>            <span class="hljs-attr">show</span>: <span class="hljs-function">() =&gt;</span> vnode.<span class="hljs-property">component</span>?.<span class="hljs-property">exposed</span>?.<span class="hljs-title function_">show</span>(),<br>            <span class="hljs-attr">hide</span>: <span class="hljs-function">() =&gt;</span> vnode.<span class="hljs-property">component</span>?.<span class="hljs-property">exposed</span>?.<span class="hljs-title function_">hide</span>()<br>        &#125;<br> <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="Main-ts"><a href="#Main-ts" class="headerlink" title="Main.ts"></a>Main.ts</h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Loading</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/loading&#x27;</span><br> <br> <br><span class="hljs-keyword">let</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)<br> <br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Loading</span>)<br> <br> <br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Lod</span> = &#123;<br>    <span class="hljs-attr">show</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>,<br>    <span class="hljs-attr">hide</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span><br>&#125;<br><span class="hljs-comment">//编写ts loading 声明文件放置报错 和 智能提示</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;@vue/runtime-core&#x27;</span> &#123;<br>    <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ComponentCustomProperties</span> &#123;<br>        <span class="hljs-attr">$loading</span>: <span class="hljs-title class_">Lod</span><br>    &#125;<br>&#125;<br> <br>app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">&#x27;#app&#x27;</span>)<br></code></pre></td></tr></table></figure>

<h5 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br> <br>  &lt;div&gt;&lt;/div&gt;<br> <br>&lt;/template&gt;<br> <br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br>import &#123; ref,reactive,getCurrentInstance&#125; from &#x27;vue&#x27;<br>const  instance = getCurrentInstance()  <br>instance?.proxy?.$Loading.show()<br>setTimeout(()=&gt;&#123;<br>  instance?.proxy?.$Loading.hide()<br>&#125;,5000)<br> <br> <br>// console.log(instance)<br>&lt;/script&gt;<br>&lt;style&gt;<br>*&#123;<br>  padding: 0;<br>  margin: 0;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<h4 id="Vue-use-源码手写"><a href="#Vue-use-源码手写" class="headerlink" title="Vue use 源码手写"></a>Vue use 源码手写</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> &#123; <span class="hljs-title class_">App</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> &#123; app &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./main&#x27;</span><br> <br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Use</span> &#123;<br>    <span class="hljs-attr">install</span>: <span class="hljs-function">(<span class="hljs-params">app: App, ...options: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> <span class="hljs-built_in">void</span><br>&#125;<br> <br><span class="hljs-keyword">const</span> installedList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()<br> <br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title class_">MyUse</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Use</span>&gt;(<span class="hljs-attr">plugin</span>: T, ...<span class="hljs-attr">options</span>: <span class="hljs-built_in">any</span>[]) &#123;<br>    <span class="hljs-keyword">if</span>(installedList.<span class="hljs-title function_">has</span>(plugin))&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&#x27;重复添加插件&#x27;</span>,plugin)<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        plugin.<span class="hljs-title function_">install</span>(app, ...options)<br>        installedList.<span class="hljs-title function_">add</span>(plugin)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="1-Fragment"><a href="#1-Fragment" class="headerlink" title="1.Fragment"></a>1.Fragment</h3><ul>
<li>在Vue2中: 组件必须有一个根标签</li>
<li>在Vue3中: 组件可以没有根标签, 内部会将多个标签包含在一个Fragment虚拟元素中</li>
<li>好处: 减少标签层级, 减小内存占用</li>
</ul>
<h3 id="2-Teleport"><a href="#2-Teleport" class="headerlink" title="2.Teleport"></a>2.Teleport</h3><ul>
<li><p>什么是Teleport？—— <code>Teleport</code> 是一种能够将我们的<strong style="color:#DD5145">组件html结构</strong>移动到指定位置的技术。</p>
</li>
<li><p>这里把当前组件html结构移动到body位置，不会在组件位置显示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;teleport to=&quot;body&quot;&gt;<br>  &lt;div v-if=&quot;isShow&quot; class=&quot;mask&quot;&gt;<br>    &lt;div class=&quot;dialog&quot;&gt;<br>      &lt;h3&gt;我是一个弹窗&lt;/h3&gt;<br>      &lt;button @click=&quot;isShow = false&quot;&gt;关闭弹窗&lt;/button&gt;<br>    &lt;/div&gt;<br>  &lt;/div&gt;<br>&lt;/teleport&gt;<br></code></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.mask</span> &#123;<br>  <span class="hljs-comment">/* 遮罩层铺满窗口 */</span><br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);<br>&#125;<br><span class="hljs-selector-class">.dialog</span> &#123;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;<br>  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;<br>  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);<br>  <span class="hljs-attribute">text-align</span>: center;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">300px</span>;<br>  <span class="hljs-attribute">background-color</span>: green;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-Suspense"><a href="#3-Suspense" class="headerlink" title="3.Suspense"></a>3.Suspense</h3><ul>
<li><p>等待异步组件时渲染一些额外内容，让应用有更好的用户体验</p>
</li>
<li><p>使用步骤：</p>
<ul>
<li><p>异步引入组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;defineAsyncComponent&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>	<span class="hljs-comment">//静态引入</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Child</span> = <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">()=&gt;</span><span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./components/Child.vue&#x27;</span>))<br></code></pre></td></tr></table></figure>
</li>
<li><p>使用<code>Suspense</code>包裹组件，并配置好<code>default</code> 与 <code>fallback</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>	&lt;div class=&quot;app&quot;&gt;<br>		&lt;h3&gt;我是App组件&lt;/h3&gt;<br>		&lt;Suspense&gt;<br>            &lt;!-- 本应加载的 --&gt;<br>			&lt;template v-slot:default&gt;<br>				&lt;Child/&gt;<br>			&lt;/template&gt;<br>			&lt;!-- 本应加载的没有加载,这时就加载这个 --&gt;<br>			&lt;template v-slot:fallback&gt;<br>				&lt;h3&gt;加载中.....&lt;/h3&gt;<br>			&lt;/template&gt;<br>		&lt;/Suspense&gt;<br>	&lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>
</li>
<li><p>另外，若 <code>Child</code> 组件的 <code>setup</code> 函数返回一个 Promise 对象，也能渲染 <code>fallback</code> 里的内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">async</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> sum = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-title function_">resolve</span>(&#123;sum&#125;)<br>    &#125;, <span class="hljs-number">3000</span>)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="4-keep-alive"><a href="#4-keep-alive" class="headerlink" title="4.keep-alive"></a>4.keep-alive</h3><p>内置组件keep-alive<br>有时候我们不希望组件被重新渲染影响使用体验；或者处于性能考虑，避免多次重复渲染降低性能。而是希望组件可以缓存下来,维持当前的状态。这时候就需要用到keep-alive组件。</p>
<p>开启keep-alive 生命周期的变化</p>
<p>初次进入时： onMounted &gt; onActivated<br>退出后触发 onDeactivated<br>再次进入：<br>只会触发 onActivated<br>事件挂载的方法等，只执行一次的放在 onMounted中；组件每次进去执行的方法放在 onActivated中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;!-- 基本 --&gt;<br>&lt;keep-alive&gt;<br>  &lt;component :is=&quot;view&quot;&gt;&lt;/component&gt;<br>&lt;/keep-alive&gt;<br> <br>&lt;!-- 多个条件判断的子组件 --&gt;<br>&lt;keep-alive&gt;<br>  &lt;comp-a v-if=&quot;a &gt; 1&quot;&gt;&lt;/comp-a&gt;<br>  &lt;comp-b v-else&gt;&lt;/comp-b&gt;<br>&lt;/keep-alive&gt;<br> <br>&lt;!-- 和 `&lt;transition&gt;` 一起使用 --&gt;<br>&lt;transition&gt;<br>  &lt;keep-alive&gt;<br>    &lt;component :is=&quot;view&quot;&gt;&lt;/component&gt;<br>  &lt;/keep-alive&gt;<br>&lt;/transition&gt;<br></code></pre></td></tr></table></figure>

<p>include 和 exclude</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;keep-alive :include=&quot;&quot; :exclude=&quot;&quot; :max=&quot;&quot;&gt;&lt;/keep-alive&gt;<br></code></pre></td></tr></table></figure>

<p>include 和 exclude 允许组件有条件地缓存。二者都可以用逗号分隔字符串、正则表达式或一个数组来表示：</p>
<p>max</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;keep-alive :max=&quot;10&quot;&gt;<br>  &lt;component :is=&quot;view&quot;&gt;&lt;/component&gt;<br>&lt;/keep-alive&gt;<br></code></pre></td></tr></table></figure>

<h3 id="5-transition动画组件"><a href="#5-transition动画组件" class="headerlink" title="5.transition动画组件"></a>5.transition动画组件</h3><p>Vue 提供了 transition 的封装组件，在下列情形中，可以给任何元素和组件添加进入&#x2F;离开过渡:</p>
<ul>
<li><p>条件渲染 (使用 v-if)</p>
</li>
<li><p>条件展示 (使用 v-show)</p>
</li>
<li><p>动态组件</p>
</li>
<li><p>组件根节点</p>
</li>
</ul>
<p>自定义 transition 过度效果，你需要对transition组件的name属性自定义。并在css中写入对应的样式</p>
<h4 id="1-过渡的类名"><a href="#1-过渡的类名" class="headerlink" title="1.过渡的类名"></a>1.过渡的类名</h4><p>在进入&#x2F;离开的过渡中，会有 6 个 class 切换。</p>
<ol>
<li><p>#过渡 class<br>在进入&#x2F;离开的过渡中，会有 6 个 class 切换。</p>
</li>
<li><p>v-enter-from：定义进入过渡的开始状态。在元素被插入之前生效，在元素被插入之后的下一帧移除。</p>
</li>
<li><p>v-enter-active：定义进入过渡生效时的状态。在整个进入过渡的阶段中应用，在元素被插入之前生效，在过渡&#x2F;动画完成之后移除。这个类可以被用来定义进入过渡的过程时间，延迟和曲线函数。</p>
</li>
<li><p>v-enter-to：定义进入过渡的结束状态。在元素被插入之后下一帧生效 (与此同时 v-enter-from 被移除)，在过渡&#x2F;动画完成之后移除。</p>
</li>
<li><p>v-leave-from：定义离开过渡的开始状态。在离开过渡被触发时立刻生效，下一帧被移除。</p>
</li>
<li><p>v-leave-active：定义离开过渡生效时的状态。在整个离开过渡的阶段中应用，在离开过渡被触发时立刻生效，在过渡&#x2F;动画完成之后移除。这个类可以被用来定义离开过渡的过程时间，延迟和曲线函数。</p>
</li>
<li><p>v-leave-to：离开过渡的结束状态。在离开过渡被触发之后下一帧生效 (与此同时 v-leave-from 被移除)，在过渡&#x2F;动画完成之后移除。</p>
</li>
</ol>
<p>如下</p>
<pre><code class="hljs">   &lt;button @click=&#39;flag = !flag&#39;&gt;切换&lt;/button&gt;
   &lt;transition name=&#39;fade&#39;&gt;
     &lt;div v-if=&#39;flag&#39; class=&quot;box&quot;&gt;&lt;/div&gt;
   &lt;/transition&gt;
</code></pre>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs css">//开始过度<br><span class="hljs-selector-class">.fade-enter-from</span>&#123;<br>   <span class="hljs-attribute">background</span>:red;<br>   <span class="hljs-attribute">width</span>:<span class="hljs-number">0px</span>;<br>   <span class="hljs-attribute">height</span>:<span class="hljs-number">0px</span>;<br>   <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotate</span>(<span class="hljs-number">360deg</span>)<br>&#125;<br>//开始过度了<br><span class="hljs-selector-class">.fade-enter-active</span>&#123;<br>  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">2.5s</span> linear;<br>&#125;<br>//过度完成<br><span class="hljs-selector-class">.fade-enter-to</span>&#123;<br>   <span class="hljs-attribute">background</span>:yellow;<br>   <span class="hljs-attribute">width</span>:<span class="hljs-number">200px</span>;<br>   <span class="hljs-attribute">height</span>:<span class="hljs-number">200px</span>;<br>&#125;<br>//离开的过度<br><span class="hljs-selector-class">.fade-leave-from</span>&#123;<br>  <span class="hljs-attribute">width</span>:<span class="hljs-number">200px</span>;<br>  <span class="hljs-attribute">height</span>:<span class="hljs-number">200px</span>;<br>  <span class="hljs-attribute">transform</span>:<span class="hljs-built_in">rotate</span>(<span class="hljs-number">360deg</span>)<br>&#125;<br>//离开中过度<br><span class="hljs-selector-class">.fade-leave-active</span>&#123;<br>  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">1s</span> linear;<br>&#125;<br>//离开完成<br><span class="hljs-selector-class">.fade-leave-to</span>&#123;<br>  <span class="hljs-attribute">width</span>:<span class="hljs-number">0px</span>;<br>   <span class="hljs-attribute">height</span>:<span class="hljs-number">0px</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="2-自定义过渡-class-类名"><a href="#2-自定义过渡-class-类名" class="headerlink" title="2.自定义过渡 class 类名"></a>2.自定义过渡 class 类名</h4><p>trasnsition props</p>
<ul>
<li><p>enter-from-class</p>
</li>
<li><p>enter-active-class</p>
</li>
<li><p>enter-to-class</p>
</li>
<li><p>leave-from-class</p>
</li>
<li><p>leave-active-class</p>
</li>
<li><p>leave-to-class</p>
</li>
</ul>
<p>自定义过度时间 单位毫秒</p>
<p>你也可以分别指定进入和离开的持续时间：</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">transition</span> <span class="hljs-attr">:duration</span>=<span class="hljs-string">&quot;1000&quot;</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">transition</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">transition</span> <span class="hljs-attr">:duration</span>=<span class="hljs-string">&quot;</span></span></span><span class="hljs-template-variable">&#123; enter: 500, leave: 800 &#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">transition</span>&gt;</span></span><br></code></pre></td></tr></table></figure>


<p>通过自定义class 结合css动画库animate css</p>
<p>安装库 npm install animate.css</p>
<p>引入 import ‘animate.css’</p>
<p>使用方法</p>
<p>官方文档 Animate.css | A cross-browser library of CSS animations.</p>
<pre><code class="hljs">    &lt;transition
        leave-active-class=&quot;animate__animated animate__bounceInLeft&quot;
        enter-active-class=&quot;animate__animated animate__bounceInRight&quot;
    &gt;
        &lt;div v-if=&quot;flag&quot; class=&quot;box&quot;&gt;&lt;/div&gt;
    &lt;/transition&gt;
</code></pre>
<h4 id="3-transition-生命周期8个"><a href="#3-transition-生命周期8个" class="headerlink" title="3.transition 生命周期8个"></a>3.transition 生命周期8个</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-meta">@before</span>-enter=<span class="hljs-string">&quot;beforeEnter&quot;</span> <span class="hljs-comment">//对应enter-from</span><br><span class="hljs-meta">@enter</span>=<span class="hljs-string">&quot;enter&quot;</span><span class="hljs-comment">//对应enter-active</span><br><span class="hljs-meta">@after</span>-enter=<span class="hljs-string">&quot;afterEnter&quot;</span><span class="hljs-comment">//对应enter-to</span><br><span class="hljs-meta">@enter</span>-cancelled=<span class="hljs-string">&quot;enterCancelled&quot;</span><span class="hljs-comment">//显示过度打断</span><br><span class="hljs-meta">@before</span>-leave=<span class="hljs-string">&quot;beforeLeave&quot;</span><span class="hljs-comment">//对应leave-from</span><br><span class="hljs-meta">@leave</span>=<span class="hljs-string">&quot;leave&quot;</span><span class="hljs-comment">//对应enter-active</span><br><span class="hljs-meta">@after</span>-leave=<span class="hljs-string">&quot;afterLeave&quot;</span><span class="hljs-comment">//对应leave-to</span><br><span class="hljs-meta">@leave</span>-cancelled=<span class="hljs-string">&quot;leaveCancelled&quot;</span><span class="hljs-comment">//离开过度打断</span><br></code></pre></td></tr></table></figure>

<p>当只用 JavaScript 过渡的时候，在 enter 和 leave 钩子中必须使用 done 进行回调</p>
<p>结合gsap 动画库使用 GreenSock</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">beforeEnter</span> = (<span class="hljs-params">el: Element</span>) =&gt; &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;进入之前from&#x27;</span>, el);<br>&#125;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Enter</span> = (<span class="hljs-params">el: Element,done:<span class="hljs-built_in">Function</span></span>) =&gt; &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;过度曲线&#x27;</span>);<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span>&#123;<br>       <span class="hljs-title function_">done</span>()<br>    &#125;,<span class="hljs-number">3000</span>)<br>&#125;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">AfterEnter</span> = (<span class="hljs-params">el: Element</span>) =&gt; &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;to&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="4-appear"><a href="#4-appear" class="headerlink" title="4.appear"></a>4.appear</h4><p>通过这个属性可以设置初始节点过度 就是页面加载完成就开始动画 对应三个状态</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">appear-active-class</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">appear-from-class</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attribute">appear-to-class</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;&quot;</span><br>appear<br></code></pre></td></tr></table></figure>

<h3 id="6-transition-group过度列表"><a href="#6-transition-group过度列表" class="headerlink" title="6.transition-group过度列表"></a>6.transition-group过度列表</h3><blockquote>
<p>一般配合v-for使用</p>
</blockquote>
<ul>
<li><p>单个节点</p>
</li>
<li><p>多个节点，每次只渲染一个</p>
</li>
</ul>
<p>那么怎么同时渲染整个列表，比如使用 v-for？在这种场景下，我们会使用 <transition-group> 组件。在我们深入例子之前，先了解关于这个组件的几个特点：</p>
<ul>
<li>默认情况下，它不会渲染一个包裹元素，但是你可以通过 tag attribute 指定渲染一个元素。</li>
<li>过渡模式不可用，因为我们不再相互切换特有的元素。</li>
<li>内部元素总是需要提供唯一的 key attribute 值。</li>
<li>CSS 过渡的类将会应用在内部的元素中，而不是这个组&#x2F;容器本身。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;transition-group&gt;<br>     &lt;div style=&quot;margin: 10px;&quot; :key=&quot;item&quot; v-for=&quot;item in list&quot;&gt;&#123;&#123; item &#125;&lt;/div&gt;<br>&lt;/transition-group&gt;<br></code></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> list = reactive&lt;<span class="hljs-built_in">number</span>[]&gt;([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>])<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Push</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    list.<span class="hljs-title function_">push</span>(<span class="hljs-number">123</span>)<br>&#125;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Pop</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    list.<span class="hljs-title function_">pop</span>()<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="2-列表的移动过渡"><a href="#2-列表的移动过渡" class="headerlink" title="2.列表的移动过渡"></a>2.列表的移动过渡</h4><p><code>&lt;transition-group&gt;</code> 组件还有一个特殊之处。除了进入和离开，它还可以为定位的改变添加动画。只需了解新增的 v-move 类就可以使用这个新功能，它会应用在元素改变定位的过程中。像之前的类名一样，它的前缀可以通过 name attribute 来自定义，也可以通过 move-class attribute 手动设置</p>
<p>下面代码很酷炫</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div&gt;<br>        &lt;button @click=&quot;shuffle&quot;&gt;Shuffle&lt;/button&gt;<br>        &lt;transition-group class=&quot;wraps&quot; name=&quot;mmm&quot; tag=&quot;ul&quot;&gt;<br>            &lt;li class=&quot;cell&quot; v-for=&quot;item in items&quot; :key=&quot;item.id&quot;&gt;&#123;&#123; item.number &#125;&#125;&lt;/li&gt;<br>        &lt;/transition-group&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br>  <br>&lt;script setup  lang=&#x27;ts&#x27;&gt;<br>import _ from &#x27;lodash&#x27;<br>import &#123; ref &#125; from &#x27;vue&#x27;<br>let items = ref(Array.apply(null, &#123; length: 81 &#125; as number[]).map((_, index) =&gt; &#123;<br>    return &#123;<br>        id: index,<br>        number: (index % 9) + 1<br>    &#125;<br>&#125;))<br>const shuffle = () =&gt; &#123;<br>    items.value = _.shuffle(items.value)<br>&#125;<br>&lt;/script&gt;<br>  <br>&lt;style scoped lang=&quot;less&quot;&gt;<br>.wraps &#123;<br>    display: flex;<br>    flex-wrap: wrap;<br>    width: calc(25px * 10 + 9px);<br>    .cell &#123;<br>        width: 25px;<br>        height: 25px;<br>        border: 1px solid #ccc;<br>        list-style-type: none;<br>        display: flex;<br>        justify-content: center;<br>        align-items: center;<br>    &#125;<br>&#125;<br> <br>.mmm-move &#123;<br>    transition: transform 0.8s ease;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<h4 id="3-状态过渡"><a href="#3-状态过渡" class="headerlink" title="3.状态过渡"></a>3.状态过渡</h4><p>Vue 也同样可以给数字 Svg 背景颜色等添加过度动画 今天演示数字变化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div&gt;<br>        &lt;input step=&quot;20&quot; v-model=&quot;num.current&quot; type=&quot;number&quot; /&gt;<br>        &lt;div&gt;&#123;&#123; num.tweenedNumber.toFixed(0) &#125;&#125;&lt;/div&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br>    <br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br>import &#123; reactive, watch &#125; from &#x27;vue&#x27;<br>import gsap from &#x27;gsap&#x27;<br>const num = reactive(&#123;<br>    tweenedNumber: 0,<br>    current:0<br>&#125;)<br> <br>watch(()=&gt;num.current, (newVal) =&gt; &#123;<br>    gsap.to(num, &#123;<br>        duration: 1,<br>        tweenedNumber: newVal<br>    &#125;)<br>&#125;)<br> <br>&lt;/script&gt;<br>    <br>&lt;style&gt;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>



<h2 id="6、其他"><a href="#6、其他" class="headerlink" title="6、其他"></a>6、其他</h2><h3 id="1-全局API的转移"><a href="#1-全局API的转移" class="headerlink" title="1.全局API的转移"></a>1.全局API的转移</h3><ul>
<li><p>Vue 2.x 有许多全局 API 和配置。</p>
<ul>
<li><p>例如：注册全局组件、注册全局指令等。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//注册全局组件</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">component</span>(<span class="hljs-string">&#x27;MyButton&#x27;</span>, &#123;<br>  <span class="hljs-attr">data</span>: <span class="hljs-function">() =&gt;</span> (&#123;<br>    <span class="hljs-attr">count</span>: <span class="hljs-number">0</span><br>  &#125;),<br>  <span class="hljs-attr">template</span>: <span class="hljs-string">&#x27;&lt;button @click=&quot;count++&quot;&gt;Clicked &#123;&#123; count &#125;&#125; times.&lt;/button&gt;&#x27;</span><br>&#125;)<br><br><span class="hljs-comment">//注册全局指令</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-string">&#x27;focus&#x27;</span>, &#123;<br>  <span class="hljs-attr">inserted</span>: <span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> el.<span class="hljs-title function_">focus</span>()<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Vue3.0中对这些API做出了调整：</p>
<ul>
<li><p>将全局的API，即：<code>Vue.xxx</code>调整到应用实例（<code>app</code>）上</p>
<table>
<thead>
<tr>
<th>2.x 全局 API（<code>Vue</code>）</th>
<th>3.x 实例 API (<code>app</code>)</th>
</tr>
</thead>
<tbody><tr>
<td>Vue.config.xxxx</td>
<td>app.config.xxxx</td>
</tr>
<tr>
<td>Vue.config.productionTip</td>
<td><strong style="color:#DD5145">移除</strong></td>
</tr>
<tr>
<td>Vue.component</td>
<td>app.component</td>
</tr>
<tr>
<td>Vue.directive</td>
<td>app.directive</td>
</tr>
<tr>
<td>Vue.mixin</td>
<td>app.mixin</td>
</tr>
<tr>
<td>Vue.use</td>
<td>app.use</td>
</tr>
<tr>
<td>Vue.prototype</td>
<td>app.config.globalProperties</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
</ul>
<h3 id="2-其他改变"><a href="#2-其他改变" class="headerlink" title="2.其他改变"></a>2.其他改变</h3><ul>
<li><p>data选项应始终被声明为一个<strong>函数</strong>。</p>
</li>
<li><p>过度类名的更改：</p>
<ul>
<li><p>Vue2.x写法</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.v-enter</span>,<br><span class="hljs-selector-class">.v-leave-to</span> &#123;<br>  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-selector-class">.v-leave</span>,<br><span class="hljs-selector-class">.v-enter-to</span> &#123;<br>  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>Vue3.x写法</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.v-enter-from</span>,<br><span class="hljs-selector-class">.v-leave-to</span> &#123;<br>  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-selector-class">.v-leave-from</span>,<br><span class="hljs-selector-class">.v-enter-to</span> &#123;<br>  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong style="color:#DD5145">移除</strong>keyCode作为 v-on 的修饰符，同时也不再支持<code>config.keyCodes</code></p>
</li>
<li><p><strong style="color:#DD5145">移除</strong><code>v-on.native</code>修饰符</p>
<ul>
<li><p>父组件中绑定事件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;my-component<br>  v-on:close=&quot;handleComponentEvent&quot;<br>  v-on:click=&quot;handleNativeClickEvent&quot;<br>/&gt;<br></code></pre></td></tr></table></figure>
</li>
<li><p>子组件中声明自定义事件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script&gt;<br>  export default &#123;<br>    emits: [&#x27;close&#x27;]<br>  &#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong style="color:#DD5145">移除</strong>过滤器（filter）</p>
<blockquote>
<p>过滤器虽然这看起来很方便，但它需要一个自定义语法，打破大括号内表达式是 “只是 JavaScript” 的假设，这不仅有学习成本，而且有实现成本！建议用方法调用或计算属性去替换过滤器。</p>
</blockquote>
</li>
<li><p>……</p>
</li>
</ul>
<h3 id="可选链操作符双问号表达式"><a href="#可选链操作符双问号表达式" class="headerlink" title="可选链操作符	双问号表达式"></a>可选链操作符	双问号表达式</h3><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs arcade">?<br>a.children?.<span class="hljs-built_in">length</span><br>返回的是 <span class="hljs-literal">undefined</span>		不会报错<br><br>??<br>a.children?.<span class="hljs-built_in">length</span> ?? []<br>返回的是	[]<br>这个只能是<span class="hljs-literal">null</span>和<span class="hljs-literal">undefined</span>，然后返回 ?? 后面的数据<br></code></pre></td></tr></table></figure>

<h3 id="Scoped和样式穿透"><a href="#Scoped和样式穿透" class="headerlink" title="Scoped和样式穿透"></a>Scoped和样式穿透</h3><p>主要是用于修改很多vue常用的组件库（element, vant, AntDesigin），虽然配好了样式但是还是需要更改其他的样式</p>
<p>就需要用到样式穿透</p>
<ul>
<li>scoped的原理</li>
</ul>
<p>vue中的scoped 通过在DOM结构以及css样式上加唯一不重复的标记:data-v-hash的方式，以保证唯一（而这个工作是由过PostCSS转译实现的），达到样式私有化模块化的目的。</p>
<p>总结一下scoped三条渲染规则：</p>
<ol>
<li><p>给HTML的DOM节点加一个不重复data属性(形如：data-v-123)来表示他的唯一性</p>
</li>
<li><p>在每句css选择器的末尾（编译后的生成的css语句）加一个当前组件的data属性选择器（如[data-v-123]）来私有化样式</p>
</li>
<li><p>如果组件内部包含有其他组件，只会给其他组件的最外层标签加上当前组件的data属性</p>
</li>
</ol>
<p>PostCSS会给一个组件中的所有dom添加了一个独一无二的动态属性data-v-xxxx，然后，给CSS选择器额外添加一个对应的属性选择器来选择该组件中dom，这种做法使得样式只作用于含有该属性的dom——组件内部dom, 从而达到了’样式模块化’的效果.</p>
<p>案例修改Element ui Input样式</p>
<p>发现没有生效<br><img src="/../img/vue/566e8a5d6e5349638615ff65771896a0.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p> 如果不写Scoped 就没问题</p>
<p>原因就是Scoped 搞的鬼 他在进行PostCss转化的时候把元素选择器默认放在了最后</p>
<p><img src="/../img/vue/c896c971d3ce407989d3439101a180ad.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p> Vue 提供了样式穿透:deep() 他的作用就是用来改变 属性选择器的位置</p>
<p><img src="/../img/vue/100a1402669844c2a0da76d7959c978e.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="/../img/vue/185233f9afe8422fa815be3a22249e4a.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="css-style"><a href="#css-style" class="headerlink" title="css style"></a>css style</h3><h4 id="1-插槽选择器"><a href="#1-插槽选择器" class="headerlink" title="1.插槽选择器"></a>1.插槽选择器</h4><p>A 组件定义一个插槽</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div&gt;<br>        我是插槽<br>        &lt;slot&gt;&lt;/slot&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br> <br>&lt;script&gt;<br>export default &#123;&#125;<br>&lt;/script&gt;<br> <br>&lt;style scoped&gt;<br> <br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<p>在App.vue 引入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div&gt;<br>        &lt;A&gt;<br>            &lt;div class=&quot;a&quot;&gt;私人定制div&lt;/div&gt;<br>        &lt;/A&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br> <br>&lt;script setup&gt;<br>import A from &quot;@/components/A.vue&quot;<br>&lt;/script&gt;<br> <br> <br>&lt;style lang=&quot;less&quot; scoped&gt;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<p>在A组件修改class a 的颜色</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span><br><span class="language-css"><span class="hljs-selector-class">.a</span>&#123;</span><br><span class="language-css">    <span class="hljs-attribute">color</span>:red</span><br><span class="language-css">&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>默认情况下，作用域样式不会影响到 <code>&lt;slot/&gt;</code> 渲染出来的内容，因为它们被认为是父组件所持有并传递进来的。</p>
<p>解决方案 slotted</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css">&lt;style scoped&gt;<br> <span class="hljs-selector-pseudo">:slotted</span>(<span class="hljs-selector-class">.a</span>) &#123;<br>    <span class="hljs-attribute">color</span>:red<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<h4 id="2-全局选择器"><a href="#2-全局选择器" class="headerlink" title="2.全局选择器"></a>2.全局选择器</h4><p>在之前我们想加入全局 样式 通常都是新建一个style 标签 不加<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=scoped&spm=1001.2101.3001.7020">scoped</a> 现在有更优雅的解决方案</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;style&gt;<br> div&#123;<br>     color:red<br> &#125;<br>&lt;/style&gt;<br> <br>&lt;style lang=&quot;less&quot; scoped&gt;<br> <br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;style lang=&quot;less&quot; scoped&gt;<br>:global(div)&#123;<br>    color:red<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<p>效果等同于上面 </p>
<h4 id="3-动态-CSS"><a href="#3-动态-CSS" class="headerlink" title="3.动态 CSS"></a>3.动态 CSS</h4><p>单文件组件的 <code>&lt;style&gt;</code> 标签可以通过 <code>v-bind</code> 这一 CSS 函数将 CSS 的值关联到动态的组件状态上：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div class=&quot;div&quot;&gt;<br>       小满是个弟弟<br>    &lt;/div&gt;<br>&lt;/template&gt;<br> <br>&lt;script lang=&quot;ts&quot; setup&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;<br>const red = ref&lt;string&gt;(&#x27;red&#x27;)<br>&lt;/script&gt;<br> <br>&lt;style lang=&quot;less&quot; scoped&gt;<br>.div&#123;<br>   color:v-bind(red)<br>&#125;<br> <br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<p>如果是对象 <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=v-bind&spm=1001.2101.3001.7020">v-bind</a> 请加引号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs vue"> &lt;template&gt;<br>    &lt;div class=&quot;div&quot;&gt;<br>        小满是个弟弟<br>    &lt;/div&gt;<br>&lt;/template&gt;<br> <br>&lt;script lang=&quot;ts&quot; setup&gt;<br>import &#123; ref &#125; from &quot;vue&quot;<br>const red = ref(&#123;<br>    color:&#x27;pink&#x27;<br>&#125;)<br>&lt;/script&gt;<br> <br>    &lt;style lang=&quot;less&quot; scoped&gt;<br>.div &#123;<br>    color: v-bind(&#x27;red.color&#x27;);<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<h4 id="4-css-module"><a href="#4-css-module" class="headerlink" title="4.css module"></a>4.css module</h4><p><code>&lt;style module&gt;</code> 标签会被编译为 CSS Modules 并且将生成的 CSS 类作为 $style 对象的键暴露给组件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;$style.red&quot;</span>&gt;</span><br>        小满是个弟弟<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br> <br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">module</span>&gt;</span><span class="language-css"></span><br><span class="language-css"><span class="hljs-selector-class">.red</span> &#123;</span><br><span class="language-css">    <span class="hljs-attribute">color</span>: red;</span><br><span class="language-css">    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;</span><br><span class="language-css">&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>自定义注入名称（多个可以用数组）</p>
<p>你可以通过给 module attribute 一个值来自定义注入的类对象的 property 键</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div :class=&quot;[zs.red,zs.border]&quot;&gt;<br>        小满是个弟弟<br>    &lt;/div&gt;<br>&lt;/template&gt;<br> <br>&lt;style module=&quot;zs&quot;&gt;<br>.red &#123;<br>    color: red;<br>    font-size: 20px;<br>&#125;<br>.border&#123;<br>    border: 1px solid #ccc;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>


<p>与组合式 API 一同使用</p>
<p>注入的类可以通过 useCssModule API 在 <code>setup() </code>和 <code>&lt;script setup&gt;</code> 中使用。对于使用了自定义注入名称的<code> &lt;style module&gt;</code> 模块，useCssModule 接收一个对应的 module attribute 值作为第一个参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div :class=&quot;[zs.red,zs.border]&quot;&gt;<br>        小满是个弟弟<br>    &lt;/div&gt;<br>&lt;/template&gt;<br> <br> <br>&lt;script setup lang=&quot;ts&quot;&gt;<br>import &#123; useCssModule &#125; from &#x27;vue&#x27;<br>const css = useCssModule(&#x27;zs&#x27;)<br>&lt;/script&gt;<br> <br>&lt;style module=&quot;zs&quot;&gt;<br>.red &#123;<br>    color: red;<br>    font-size: 20px;<br>&#125;<br>.border&#123;<br>    border: 1px solid #ccc;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>



<h2 id="tsx"><a href="#tsx" class="headerlink" title="tsx"></a>tsx</h2><p>我们之前呢是使用Template去写我们模板。现在可以扩展另一种风格<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=TSX&spm=1001.2101.3001.7020">TSX</a>风格</p>
<p>vue2 的时候就已经支持<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=jsx&spm=1001.2101.3001.7020">jsx</a>写法，只不过不是很友好，随着vue3对typescript的支持度，tsx写法越来越被接受</p>
<h3 id="1-安装插件"><a href="#1-安装插件" class="headerlink" title="1.安装插件"></a>1.安装插件</h3><p>npm install @vitejs&#x2F;plugin-vue-jsx -D</p>
<p>vite.config.ts 配置</p>
<p><img src="/../img/vue/35486eb0bd1a4dabac0035384f877cbe.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; defineConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite&#x27;</span><br><span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@vitejs/plugin-vue&#x27;</span><br><span class="hljs-keyword">import</span> vueJsx <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@vitejs/plugin-vue-jsx&#x27;</span>;<br><span class="hljs-comment">// https://vitejs.dev/config/</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>(),<span class="hljs-title function_">vueJsx</span>()]<br>&#125;)<br></code></pre></td></tr></table></figure>

<h3 id="2-修改tsconfig-json-配置文件"><a href="#2-修改tsconfig-json-配置文件" class="headerlink" title="2.修改tsconfig.json 配置文件"></a>2.修改tsconfig.json 配置文件</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;jsx&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;preserve&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;jsxFactory&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;h&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;jsxFragmentFactory&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Fragment&quot;</span><span class="hljs-punctuation">,</span><br></code></pre></td></tr></table></figure>

<p><img src="/../img/vue/e6d0ae1a4c254f13bde802f408fed4b3.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>配置完成就可以使用啦</p>
<p>在目录新建一个xxxxxx.tsx文件</p>
<h3 id="3-使用TSX"><a href="#3-使用TSX" class="headerlink" title="3.使用TSX"></a>3.使用TSX</h3><p>TIPS tsx不会自动解包使用ref加.vlaue ! ! !</p>
<h4 id="tsx支持-v-model-的使用"><a href="#tsx支持-v-model-的使用" class="headerlink" title="tsx支持 v-model 的使用"></a>tsx支持 v-model 的使用</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs ts"> <br><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br> <br><span class="hljs-keyword">let</span> v = ref&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">&#x27;&#x27;</span>)<br> <br><span class="hljs-keyword">const</span> <span class="hljs-title function_">renderDom</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> (<br>        <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">           <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&#123;v.value&#125;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> /&gt;</span></span><br><span class="language-xml">           <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">               &#123;v.value&#125;</span><br><span class="language-xml">           <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/&gt;</span></span><br>    )<br>&#125;<br> <br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> renderDom<br></code></pre></td></tr></table></figure>

<h4 id="v-show"><a href="#v-show" class="headerlink" title="v-show"></a>v-show</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs ts"> <br><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br> <br><span class="hljs-keyword">let</span> flag = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)<br> <br><span class="hljs-keyword">const</span> <span class="hljs-title function_">renderDom</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> (<br>        <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">           <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">&#123;flag.value&#125;</span>&gt;</span>景天<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">           <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">&#123;!flag.value&#125;</span>&gt;</span>雪见<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/&gt;</span></span><br>    )<br>&#125;<br> <br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> renderDom<br></code></pre></td></tr></table></figure>

<h4 id="v-if是不支持的"><a href="#v-if是不支持的" class="headerlink" title="v-if是不支持的"></a>v-if是不支持的</h4><p>所以需要改变风格</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br> <br><span class="hljs-keyword">let</span> flag = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)<br> <br><span class="hljs-keyword">const</span> <span class="hljs-title function_">renderDom</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> (<br>        <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">            &#123;</span><br><span class="language-xml">                flag.value ? <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>景天<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> : <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>雪见<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">            &#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/&gt;</span></span><br>    )<br>&#125;<br> <br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> renderDom<br></code></pre></td></tr></table></figure>

<h4 id="v-for也是不支持的"><a href="#v-for也是不支持的" class="headerlink" title="v-for也是不支持的"></a>v-for也是不支持的</h4><p>需要使用Map</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br> <br><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>]<br> <br><span class="hljs-keyword">const</span> <span class="hljs-title function_">renderDom</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> (<br>        <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">            &#123;</span><br><span class="language-xml">              arr.map(v=&gt;&#123;</span><br><span class="language-xml">                  return <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>$&#123;v&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">              &#125;)</span><br><span class="language-xml">            &#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/&gt;</span></span><br>    )<br>&#125;<br> <br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> renderDom<br></code></pre></td></tr></table></figure>

<h4 id="v-bind使用"><a href="#v-bind使用" class="headerlink" title="v-bind使用"></a>v-bind使用</h4><p>直接赋值就可以</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br> <br><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]<br> <br><span class="hljs-keyword">const</span> <span class="hljs-title function_">renderDom</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> (<br>        <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">data-arr</span>=<span class="hljs-string">&#123;arr&#125;</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/&gt;</span></span><br>    )<br>&#125;<br> <br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> renderDom<br></code></pre></td></tr></table></figure>

<h4 id="v-on绑定事件-所有的事件都按照react风格来"><a href="#v-on绑定事件-所有的事件都按照react风格来" class="headerlink" title="v-on绑定事件 所有的事件都按照react风格来"></a>v-on绑定事件 所有的事件都按照react风格来</h4><ul>
<li>所有事件有on开头</li>
<li>所有事件名称首字母大写</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs ts"> <br><span class="hljs-keyword">const</span> <span class="hljs-title function_">renderDom</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> (<br>        <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;clickTap&#125;</span>&gt;</span>点击<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/&gt;</span></span><br>    )<br>&#125;<br> <br><span class="hljs-keyword">const</span> <span class="hljs-title function_">clickTap</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;click&#x27;</span>);<br>&#125;<br> <br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> renderDom<br></code></pre></td></tr></table></figure>

<h4 id="Props-接受值"><a href="#Props-接受值" class="headerlink" title="Props 接受值"></a>Props 接受值</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs ts"> <br><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br> <br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Props</span> = &#123;<br>    <span class="hljs-attr">title</span>:<span class="hljs-built_in">string</span><br>&#125;<br> <br><span class="hljs-keyword">const</span> <span class="hljs-title function_">renderDom</span> = (<span class="hljs-params">props:Props</span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> (<br>        <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;props.title&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;clickTap&#125;</span>&gt;</span>点击<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/&gt;</span></span><br>    )<br>&#125;<br> <br><span class="hljs-keyword">const</span> <span class="hljs-title function_">clickTap</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;click&#x27;</span>);<br>&#125;<br> <br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> renderDom<br></code></pre></td></tr></table></figure>

<h4 id="Emit派发"><a href="#Emit派发" class="headerlink" title="Emit派发"></a>Emit派发</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Props</span> = &#123;<br>    <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span><br>&#125;<br> <br><span class="hljs-keyword">const</span> <span class="hljs-title function_">renderDom</span> = (<span class="hljs-params">props: Props,content:<span class="hljs-built_in">any</span></span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> (<br>        <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;props.title&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;clickTap.bind(this,content)&#125;</span>&gt;</span>点击<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/&gt;</span></span><br>    )<br>&#125;<br> <br><span class="hljs-keyword">const</span> <span class="hljs-title function_">clickTap</span> = (<span class="hljs-params">ctx:<span class="hljs-built_in">any</span></span>) =&gt; &#123;<br> <br>    ctx.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;on-click&#x27;</span>,<span class="hljs-number">1</span>)<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="Slot"><a href="#Slot" class="headerlink" title="Slot"></a>Slot</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">A</span> = (<span class="hljs-params">props, &#123; slots &#125;</span>) =&gt; (<br>  <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123; slots.default ? slots.default() : &#x27;foo&#x27; &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>&#123; slots.bar?.() &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/&gt;</span></span><br>);<br> <br><span class="hljs-keyword">const</span> <span class="hljs-title class_">App</span> = &#123;<br>  <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> slots = &#123;<br>      <span class="hljs-attr">bar</span>: <span class="hljs-function">() =&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>B<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>,<br>    &#125;;<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">A</span> <span class="hljs-attr">v-slots</span>=<span class="hljs-string">&#123;slots&#125;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>A<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">A</span>&gt;</span></span><br>    );<br>  &#125;,<br>&#125;;<br> <br><span class="hljs-comment">// or</span><br> <br><span class="hljs-keyword">const</span> <span class="hljs-title class_">App</span> = &#123;<br>  <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> slots = &#123;<br>      <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>A<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,<br>      <span class="hljs-attr">bar</span>: <span class="hljs-function">() =&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>B<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>,<br>    &#125;;<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">A</span> <span class="hljs-attr">v-slots</span>=<span class="hljs-string">&#123;slots&#125;</span> /&gt;</span></span>;<br>  &#125;,<br>&#125;;<br> <br><span class="hljs-comment">// or you can use object slots when `enableObjectSlots` is not false.</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">App</span> = &#123;<br>  <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">A</span>&gt;</span></span><br><span class="language-xml">          &#123;&#123;</span><br><span class="language-xml">            default: () =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>A<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>,</span><br><span class="language-xml">            bar: () =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>B<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>,</span><br><span class="language-xml">          &#125;&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">A</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">B</span>&gt;</span>&#123;() =&gt; &quot;foo&quot;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">B</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/&gt;</span></span><br>    );<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure>

<h2 id="Event-Loop-和-nextTick"><a href="#Event-Loop-和-nextTick" class="headerlink" title="Event Loop 和 nextTick"></a>Event Loop 和 nextTick</h2><h3 id="JS-执行机制"><a href="#JS-执行机制" class="headerlink" title="JS 执行机制"></a>JS 执行机制</h3><p>在我们学js 的时候都知道js 是单线程的如果是多线程的话会引发一个问题在同一时间同时操作DOM 一个增加一个删除JS就不知道到底要干嘛了，所以这个语言是单线程的但是随着HTML5到来js也支持了多线程webWorker 但是也是不允许操作DOM</p>
<p>单线程就意味着所有的任务都需要排队，后面的任务需要等前面的任务执行完才能执行，如果前面的任务耗时过长，后面的任务就需要一直等，一些从用户角度上不需要等待的任务就会一直等待，这个从体验角度上来讲是不可接受的，所以JS中就出现了异步的概念。</p>
<h3 id="同步任务"><a href="#同步任务" class="headerlink" title="同步任务"></a>同步任务</h3><p>代码从上到下按顺序执行</p>
<h3 id="异步任务"><a href="#异步任务" class="headerlink" title="异步任务"></a>异步任务</h3><h4 id="1-宏任务"><a href="#1-宏任务" class="headerlink" title="1.宏任务"></a>1.宏任务</h4><p>script(整体代码)、setTimeout、setInterval、UI交互事件、postMessage、Ajax</p>
<h4 id="2-微任务"><a href="#2-微任务" class="headerlink" title="2.微任务"></a>2.微任务</h4><p>Promise.then catch finally、MutaionObserver、process.nextTick(Node.js 环境)</p>
<h4 id="运行机制"><a href="#运行机制" class="headerlink" title="运行机制"></a>运行机制</h4><p>所有的同步任务都是在主进程执行的形成一个执行栈，主线程之外，还存在一个”任务队列”，异步任务执行队列中先执行宏任务，然后清空当次宏任务中的所有微任务，然后进行下一个tick如此形成循环。</p>
<p>nextTick 就是创建一个异步任务，那么它自然要等到同步任务执行完成后才执行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   &lt;div ref=&quot;xiaoman&quot;&gt;<br>      &#123;&#123; text &#125;&#125;<br>   &lt;/div&gt;<br>   &lt;button @click=&quot;change&quot;&gt;change div&lt;/button&gt;<br>&lt;/template&gt;<br>   <br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br>import &#123; ref,nextTick &#125; from &#x27;vue&#x27;;<br> <br>const text = ref(&#x27;小满开飞机&#x27;)<br>const xiaoman = ref&lt;HTMLElement&gt;()<br> <br>const change = async () =&gt; &#123;<br>   text.value = &#x27;小满不开飞机&#x27;<br>   console.log(xiaoman.value?.innerText) //小满开飞机<br>   await nextTick();<br>   console.log(xiaoman.value?.innerText) //小满不开飞机<br>&#125;<br> <br> <br>&lt;/script&gt;<br> <br> <br>&lt;style  scoped&gt;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<p>nextTick 接受一个参数fn（函数）定义了一个变量P 这个P最终返回都是Promise，最后是return 如果传了fn 就使用变量P.then执行一个微任务去执行fn函数，then里面this 如果有值就调用bind改变this指向返回新的函数，否则直接调用fn，如果没传fn，就返回一个promise，最终结果都会返回一个promise</p>
<p>在我们之前讲过的ref源码中有一段 triggerRefValue  他会去调用 triggerEffects</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">triggerRefValue</span>(<span class="hljs-params">ref: RefBase&lt;<span class="hljs-built_in">any</span>&gt;, newVal?: <span class="hljs-built_in">any</span></span>) &#123;<br>  ref = <span class="hljs-title function_">toRaw</span>(ref)<br>  <span class="hljs-keyword">if</span> (ref.<span class="hljs-property">dep</span>) &#123;<br>    <span class="hljs-keyword">if</span> (__DEV__) &#123;<br>      <span class="hljs-title function_">triggerEffects</span>(ref.<span class="hljs-property">dep</span>, &#123;<br>        <span class="hljs-attr">target</span>: ref,<br>        <span class="hljs-attr">type</span>: <span class="hljs-title class_">TriggerOpTypes</span>.<span class="hljs-property">SET</span>,<br>        <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;value&#x27;</span>,<br>        <span class="hljs-attr">newValue</span>: newVal<br>      &#125;)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">triggerEffects</span>(ref.<span class="hljs-property">dep</span>)<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">triggerEffects</span>(<span class="hljs-params"></span><br><span class="hljs-params">  dep: Dep | ReactiveEffect[],</span><br><span class="hljs-params">  debuggerEventExtraInfo?: DebuggerEventExtraInfo</span><br><span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// spread into array for stabilization</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> effect <span class="hljs-keyword">of</span> <span class="hljs-title function_">isArray</span>(dep) ? dep : [...dep]) &#123;<br>    <span class="hljs-keyword">if</span> (effect !== activeEffect || effect.<span class="hljs-property">allowRecurse</span>) &#123;<br>      <span class="hljs-keyword">if</span> (__DEV__ &amp;&amp; effect.<span class="hljs-property">onTrigger</span>) &#123;<br>        effect.<span class="hljs-title function_">onTrigger</span>(<span class="hljs-title function_">extend</span>(&#123; effect &#125;, debuggerEventExtraInfo))<br>      &#125;<br>      <span class="hljs-comment">//当响应式对象发生改变后，执行 effect 如果有 scheduler 这个参数，会执行这个 scheduler 函数</span><br>      <span class="hljs-keyword">if</span> (effect.<span class="hljs-property">scheduler</span>) &#123;<br>        effect.<span class="hljs-title function_">scheduler</span>()<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        effect.<span class="hljs-title function_">run</span>()<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>那么scheduler 这个函数从哪儿来的 我们看这个类 ReactiveEffect</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactiveEffect</span>&lt;T = <span class="hljs-built_in">any</span>&gt; &#123;<br>  active = <span class="hljs-literal">true</span><br>  <span class="hljs-attr">deps</span>: <span class="hljs-title class_">Dep</span>[] = []<br>  <span class="hljs-attr">parent</span>: <span class="hljs-title class_">ReactiveEffect</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span><br> <br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * Can be attached after creation</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@internal</span></span><br><span class="hljs-comment">   */</span><br>  computed?: <span class="hljs-title class_">ComputedRefImpl</span>&lt;T&gt;<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@internal</span></span><br><span class="hljs-comment">   */</span><br>  allowRecurse?: <span class="hljs-built_in">boolean</span><br> <br>  onStop?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span><br>  <span class="hljs-comment">// dev only</span><br>  onTrack?: <span class="hljs-function">(<span class="hljs-params">event: DebuggerEvent</span>) =&gt;</span> <span class="hljs-built_in">void</span><br>  <span class="hljs-comment">// dev only</span><br>  onTrigger?: <span class="hljs-function">(<span class="hljs-params">event: DebuggerEvent</span>) =&gt;</span> <span class="hljs-built_in">void</span><br> <br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span><br><span class="hljs-params">    <span class="hljs-keyword">public</span> fn: () =&gt; T,</span><br><span class="hljs-params">    <span class="hljs-keyword">public</span> scheduler: EffectScheduler | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>, <span class="hljs-comment">//我在这儿 </span></span><br><span class="hljs-params">    scope?: EffectScope</span><br><span class="hljs-params">  </span>) &#123;<br>    <span class="hljs-title function_">recordEffectScope</span>(<span class="hljs-variable language_">this</span>, scope)<br>  &#125;<br></code></pre></td></tr></table></figure>

<p>那么scheduler 这个函数从哪儿来的 我们看这个类 ReactiveEffect</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactiveEffect</span>&lt;T = <span class="hljs-built_in">any</span>&gt; &#123;<br>  active = <span class="hljs-literal">true</span><br>  <span class="hljs-attr">deps</span>: <span class="hljs-title class_">Dep</span>[] = []<br>  <span class="hljs-attr">parent</span>: <span class="hljs-title class_">ReactiveEffect</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span><br> <br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * Can be attached after creation</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@internal</span></span><br><span class="hljs-comment">   */</span><br>  computed?: <span class="hljs-title class_">ComputedRefImpl</span>&lt;T&gt;<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@internal</span></span><br><span class="hljs-comment">   */</span><br>  allowRecurse?: <span class="hljs-built_in">boolean</span><br> <br>  onStop?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span><br>  <span class="hljs-comment">// dev only</span><br>  onTrack?: <span class="hljs-function">(<span class="hljs-params">event: DebuggerEvent</span>) =&gt;</span> <span class="hljs-built_in">void</span><br>  <span class="hljs-comment">// dev only</span><br>  onTrigger?: <span class="hljs-function">(<span class="hljs-params">event: DebuggerEvent</span>) =&gt;</span> <span class="hljs-built_in">void</span><br> <br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span><br><span class="hljs-params">    <span class="hljs-keyword">public</span> fn: () =&gt; T,</span><br><span class="hljs-params">    <span class="hljs-keyword">public</span> scheduler: EffectScheduler | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>, <span class="hljs-comment">//我在这儿 </span></span><br><span class="hljs-params">    scope?: EffectScope</span><br><span class="hljs-params">  </span>) &#123;<br>    <span class="hljs-title function_">recordEffectScope</span>(<span class="hljs-variable language_">this</span>, scope)<br>  &#125;<br></code></pre></td></tr></table></figure>

<p>scheduler 作为一个参数传进来的</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> effect = (instance.<span class="hljs-property">effect</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReactiveEffect</span>(<br>   componentUpdateFn,<br>   <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">queueJob</span>(instance.<span class="hljs-property">update</span>),<br>   instance.<span class="hljs-property">scope</span> <span class="hljs-comment">// track it in component&#x27;s effect scope</span><br> ))<br></code></pre></td></tr></table></figure>

<p>他是在初始化 effect 通过 queueJob 传进来的</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">//queueJob 维护job列队，有去重逻辑，保证任务的唯一性，每次调用去执行，被调用的时候去重，每次调用去执行 queueFlush</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">queueJob</span>(<span class="hljs-params">job: SchedulerJob</span>) &#123;<br>  <span class="hljs-comment">// 判断条件：主任务队列为空 或者 有正在执行的任务且没有在主任务队列中  &amp;&amp; job 不能和当前正在执行任务及后面待执行任务相同</span><br>  <span class="hljs-comment">// 重复数据删除：</span><br>  <span class="hljs-comment">// - 使用Array.includes(Obj, startIndex) 的 起始索引参数：startIndex</span><br>  <span class="hljs-comment">// - startIndex默认为包含当前正在运行job的index，此时，它不能再次递归触发自身</span><br>  <span class="hljs-comment">// - 如果job是一个watch()回调函数或者当前job允许递归触发，则搜索索引将+1，以允许他递归触发自身-用户需要确保回调函数不会死循环</span><br>  <span class="hljs-keyword">if</span> (<br>    (!queue.<span class="hljs-property">length</span> ||<br>      !queue.<span class="hljs-title function_">includes</span>(<br>        job,<br>        isFlushing &amp;&amp; job.<span class="hljs-property">allowRecurse</span> ? flushIndex + <span class="hljs-number">1</span> : flushIndex<br>      )) &amp;&amp;<br>    job !== currentPreFlushParentJob<br>  ) &#123;<br>    <span class="hljs-keyword">if</span> (job.<span class="hljs-property">id</span> == <span class="hljs-literal">null</span>) &#123;<br>      queue.<span class="hljs-title function_">push</span>(job)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      queue.<span class="hljs-title function_">splice</span>(<span class="hljs-title function_">findInsertionIndex</span>(job.<span class="hljs-property">id</span>), <span class="hljs-number">0</span>, job)<br>    &#125;<br>    <span class="hljs-title function_">queueFlush</span>()<br>  &#125;<br>&#125;<br><br> queueJob 维护job列队 并且调用  queueFlush<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">queueFlush</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// 避免重复调用flushJobs</span><br>  <span class="hljs-keyword">if</span> (!isFlushing &amp;&amp; !isFlushPending) &#123;<br>    isFlushPending = <span class="hljs-literal">true</span><br>     <span class="hljs-comment">//开启异步任务处理flushJobs</span><br>    currentFlushPromise = resolvedPromise.<span class="hljs-title function_">then</span>(flushJobs)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>queueFlush 给每一个队列创建了微任务</p>
<h3 id="如何去理解Tick"><a href="#如何去理解Tick" class="headerlink" title="如何去理解Tick"></a>如何去理解Tick</h3><blockquote>
<p>vue更新dom是异步的，数据更新是同步的</p>
<p>当我们操作dom的时候发现数据获取的是上次的，就需要使用nextTick</p>
</blockquote>
<p>例如我们显示器是60FPS</p>
<p>那浏览器绘制一帧就是1000 &#x2F; 60  ≈ 16.6ms</p>
<p>那浏览器这一帧率做了什么</p>
<p>1.处理用户的事件，就是event 例如 click，input change 等。</p>
<p>2.执行定时器任务</p>
<p>3.执行 requestAnimationFrame 动画</p>
<p>4.执行dom 的回流与重绘</p>
<p>5.计算更新图层的绘制指令</p>
<p>6.绘制指令合并主线程 如果有空余时间会执行 requestidlecallback</p>
<p>所以 一个Tick 就是去做了这些事</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div ref=&quot;box&quot; class=&quot;wraps&quot;&gt;<br>    &lt;div&gt;<br>      &lt;div class=&quot;item&quot; v-for=&quot;item in chatList&quot;&gt;<br>        &lt;div&gt;&#123;&#123; item.name &#125;&#125;:&lt;/div&gt;<br>        &lt;div&gt;&#123;&#123; item.message &#125;&#125;&lt;/div&gt;<br>      &lt;/div&gt;<br>    &lt;/div&gt;<br>  &lt;/div&gt;<br>  &lt;div class=&quot;ipt&quot;&gt;<br>    &lt;div&gt;<br>      &lt;textarea v-model=&quot;ipt&quot; type=&quot;text&quot; /&gt;<br>    &lt;/div&gt;<br>    &lt;div&gt;<br>      &lt;button @click=&quot;send&quot;&gt;send&lt;/button&gt;<br>    &lt;/div&gt;<br>  &lt;/div&gt;<br>&lt;HelloWorld&gt;&lt;/HelloWorld&gt;<br>&lt;/template&gt;<br> <br>&lt;script setup lang=&#x27;ts&#x27;&gt;<br>import &#123; reactive,ref,nextTick,getCurrentInstance, watch &#125; from &#x27;vue&#x27;<br>import HelloWorld from &#x27;./components/HelloWorld.vue&#x27;;<br>// let instance = getCurrentInstance()<br>// console.log(instance);<br>let current = ref(0)<br>watch(current,(newVal,oldVal)=&gt;&#123;<br>  console.log(newVal);<br>&#125;)<br>//next Tick<br>//60FPS 1000/60 = 16.7ms<br>// 1.处理用户的事件，就是event 例如 click，input change 等。<br> <br>// 2.执行定时器任务<br> <br>// 3.执行 requestAnimationFrame<br> <br>// 4.执行dom 的回流与重绘<br> <br>// 5.计算更新图层的绘制指令<br> <br>// 6.绘制指令合并主线程 如果有空余时间会执行 requestidlecallback<br> <br>// for (let i =0;i&lt;1000;i++) &#123;<br>//   current.value = i<br>// &#125;<br> <br>let chatList = reactive([<br>  &#123; name: &#x27;张三&#x27;, message: &quot;xxxxxxxxx&quot; &#125;,<br>])<br>let box = ref&lt;HTMLDivElement&gt;()<br>let ipt = ref(&#x27;&#x27;)<br>//Vue 更新dom是异步的 数据更新是同步<br>//我们本次执行的代码是同步代码<br>//当我们操作dom 的时候发现数据读取的是上次的 就需要使用nextIick<br>const send = async () =&gt; &#123;<br>  chatList.push(&#123;<br>     name:&quot;小满&quot;,<br>     message:ipt.value<br>  &#125;)<br>  //1.回调函数模式<br>  //2.async await 写法<br>  await nextTick()<br>  box.value!.scrollTop = 99999999<br> <br>  //ipt.value = &#x27;&#x27;<br>&#125;<br>&lt;/script&gt;<br> <br>&lt;style scoped lang=&#x27;less&#x27;&gt;<br>.wraps &#123;<br>  margin: 10px auto;<br>  width: 500px;<br>  height: 400px;<br>  overflow: auto;<br>  overflow-x: hidden;<br>  background: #fff;<br>  border: 1px solid #ccc;<br> <br>  .item &#123;<br>    width: 100%;<br>    height: 50px;<br>    background: #ccc;<br>    display: flex;<br>    align-items: center;<br>    padding: 0 10px;<br>    border-bottom: 1px solid #fff;<br>  &#125;<br>&#125;<br> <br>.ipt &#123;<br>  margin: 10px auto;<br>  width: 500px;<br>  height: 40px;<br>  background: #fff;<br>  border: 1px solid #ccc;<br> <br>  textarea &#123;<br>    width: 100%;<br>    height: 100%;<br>    border: none;<br>    outline: none;<br>  &#125;<br>  button &#123;<br>    width: 100px;<br>    margin: 10px 0;<br>    float: right;<br>  &#125;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<h2 id="vue开发移动-amp-打包APP"><a href="#vue开发移动-amp-打包APP" class="headerlink" title="vue开发移动&amp;打包APP"></a>vue开发移动&amp;打包APP</h2><h2 id="unocss原子化"><a href="#unocss原子化" class="headerlink" title="unocss原子化"></a>unocss原子化</h2><p>什么是css原子化？<br>CSS原子化的优缺点</p>
<p>1.减少了css体积，提高了css复用</p>
<p>2.减少起名的复杂度</p>
<p>3.增加了记忆成本 将css拆分为原子之后，你势必要记住一些class才能书写，哪怕tailwindcss提供了完善的工具链，你写background，也要记住开头是bg</p>
<h2 id="常见库"><a href="#常见库" class="headerlink" title="常见库"></a>常见库</h2><ul>
<li>lodash</li>
<li>gsap</li>
<li>Mitt — Bus</li>
<li>unplugin-auto-import — 自动引入ref之类的</li>
<li>vueuse</li>
<li>Tailwind CSS</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E7%AC%94%E8%AE%B0/" class="category-chain-item">笔记</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/vue/">#vue</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>vue3</div>
      <div>https://xiehongchen.github.io/2023/03/22/vue3/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>XieHongchen</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年3月22日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/03/22/nodejs/" title="nodejs">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">nodejs</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/03/22/vue2/" title="vue2">
                        <span class="hidden-mobile">vue2</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
